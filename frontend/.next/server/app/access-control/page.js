(()=>{var e={};e.id=685,e.ids=[685],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1630:e=>{"use strict";e.exports=require("http")},1997:e=>{"use strict";e.exports=require("punycode")},2633:(e,s,t)=>{"use strict";t.d(s,{A:()=>r});let r=(0,t(9377).A)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]])},2643:(e,s,t)=>{"use strict";t.d(s,{$:()=>n});var r=t(687),a=t(3210),l=t(4780);let n=a.forwardRef(({className:e,variant:s="default",size:t="default",...a},n)=>(0,r.jsx)("button",{className:(0,l.cn)("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-white transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{"bg-blue-600 text-white hover:bg-blue-700":"default"===s,"bg-red-600 text-white hover:bg-red-700":"destructive"===s,"border border-gray-300 bg-white hover:bg-gray-50":"outline"===s,"bg-gray-100 text-gray-900 hover:bg-gray-200":"secondary"===s,"hover:bg-gray-100":"ghost"===s,"text-blue-600 underline-offset-4 hover:underline":"link"===s},{"h-10 px-4 py-2":"default"===t,"h-9 rounded-md px-3":"sm"===t,"h-11 rounded-md px-8":"lg"===t,"h-10 w-10":"icon"===t},e),ref:n,...a}));n.displayName="Button"},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3106:(e,s,t)=>{"use strict";t.d(s,{A:()=>r});let r=(0,t(9377).A)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]])},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3323:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>n.a,__next_app__:()=>m,pages:()=>o,routeModule:()=>x,tree:()=>d});var r=t(5239),a=t(8088),l=t(8170),n=t.n(l),i=t(893),c={};for(let e in i)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>i[e]);t.d(s,c);let d={children:["",{children:["access-control",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,6973)),"/home/ubuntu/ETLA-Platform/frontend/src/app/access-control/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,4431)),"/home/ubuntu/ETLA-Platform/frontend/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,7398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(t.t.bind(t,9999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(t.t.bind(t,5284,23)),"next/dist/client/components/unauthorized-error"]}]}.children,o=["/home/ubuntu/ETLA-Platform/frontend/src/app/access-control/page.tsx"],m={require:t,loadChunk:()=>Promise.resolve()},x=new r.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/access-control/page",pathname:"/access-control",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},3873:e=>{"use strict";e.exports=require("path")},4075:e=>{"use strict";e.exports=require("zlib")},4463:(e,s,t)=>{"use strict";t.d(s,{A:()=>r});let r=(0,t(9377).A)("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]])},4763:(e,s,t)=>{Promise.resolve().then(t.bind(t,6973))},4771:(e,s,t)=>{"use strict";t.d(s,{A:()=>r});let r=(0,t(9377).A)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]])},5315:(e,s,t)=>{"use strict";t.d(s,{A:()=>r});let r=(0,t(9377).A)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])},5545:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>Z});var r=t(687),a=t(3210),l=t(3732),n=t(6257),i=t(8749),c=t(2643),d=t(9987),o=t(8520),m=t(9362),x=t(2420),u=t(3106),h=t(4463),p=t(5377),j=t(6073),g=t(8188),b=t(152),v=t(9235),y=t(983),f=t(5315),N=t(9377);let w=(0,N.A)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);var _=t(6228),A=t(9082),k=t(9720);let C=(0,N.A)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);var S=t(1635),U=t(9446),D=t(7473),P=t(2633),$=t(2457),T=t(6391);function E({isOpen:e,onClose:s,onSuccess:t,tenants:l}){let[n,d]=(0,a.useState)({email:"",full_name:"",phone:"",department:"",job_title:"",role:"user",role_level:"sub_client",tenant_id:"",password:"",can_invite_users:!1,can_manage_sub_clients:!1,permission_scope:"own"}),[o,m]=(0,a.useState)(!1),[h,p]=(0,a.useState)(""),j=(e,s)=>{if(d(t=>({...t,[e]:s})),"role_level"===e){let e="host"===s?"all":"primary_client"===s?"tenant":"own";d(s=>({...s,permission_scope:e}))}},g=async e=>{e.preventDefault(),m(!0),p("");try{if(!n.email||!n.full_name||!n.tenant_id||!n.password)return void p("Please fill in all required fields");let e={email:n.email,full_name:n.full_name,phone:n.phone||void 0,department:n.department||void 0,job_title:n.job_title||void 0,role:n.role,role_level:n.role_level,tenant_id:n.tenant_id,password:n.password,can_invite_users:n.can_invite_users,can_manage_sub_clients:n.can_manage_sub_clients,permission_scope:n.permission_scope},r=await T.Lr.createUser(e);r.success?(t(),s(),d({email:"",full_name:"",phone:"",department:"",job_title:"",role:"user",role_level:"sub_client",tenant_id:"",password:"",can_invite_users:!1,can_manage_sub_clients:!1,permission_scope:"own"})):p(r.error||"Failed to create user")}catch(e){p("An error occurred while creating the user"),console.error("User creation error:",e)}finally{m(!1)}};return e?(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,r.jsxs)(i.Zp,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,r.jsx)(i.aR,{children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)(i.ZB,{className:"flex items-center",children:[(0,r.jsx)(U.A,{className:"h-5 w-5 mr-2"}),"Create New User"]}),(0,r.jsx)(i.BT,{children:"Add a new user to the system with appropriate role and permissions"})]}),(0,r.jsx)(c.$,{variant:"outline",size:"sm",onClick:s,children:(0,r.jsx)(D.A,{className:"h-4 w-4"})})]})}),(0,r.jsx)(i.Wu,{children:(0,r.jsxs)("form",{onSubmit:g,className:"space-y-6",children:[h&&(0,r.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-3",children:(0,r.jsx)("p",{className:"text-sm text-red-600",children:h})}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Basic Information"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[(0,r.jsx)(u.A,{className:"h-4 w-4 inline mr-1"}),"Email Address *"]}),(0,r.jsx)("input",{type:"email",required:!0,value:n.email,onChange:e=>j("email",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"user@company.com"})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[(0,r.jsx)(U.A,{className:"h-4 w-4 inline mr-1"}),"Full Name *"]}),(0,r.jsx)("input",{type:"text",required:!0,value:n.full_name,onChange:e=>j("full_name",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"John Doe"})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[(0,r.jsx)(P.A,{className:"h-4 w-4 inline mr-1"}),"Phone Number"]}),(0,r.jsx)("input",{type:"tel",value:n.phone,onChange:e=>j("phone",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"+1 (555) 123-4567"})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[(0,r.jsx)($.A,{className:"h-4 w-4 inline mr-1"}),"Job Title"]}),(0,r.jsx)("input",{type:"text",value:n.job_title,onChange:e=>j("job_title",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Software Engineer"})]}),(0,r.jsxs)("div",{className:"md:col-span-2",children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[(0,r.jsx)(v.A,{className:"h-4 w-4 inline mr-1"}),"Department"]}),(0,r.jsx)("input",{type:"text",value:n.department,onChange:e=>j("department",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Engineering"})]})]})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Role and Permissions"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[(0,r.jsx)(x.A,{className:"h-4 w-4 inline mr-1"}),"Role Level *"]}),(0,r.jsxs)("select",{required:!0,value:n.role_level,onChange:e=>j("role_level",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,r.jsx)("option",{value:"sub_client",children:"Sub Client"}),(0,r.jsx)("option",{value:"primary_client",children:"Primary Client"}),(0,r.jsx)("option",{value:"host",children:"Host Admin"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role *"}),(0,r.jsxs)("select",{required:!0,value:n.role,onChange:e=>j("role",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,r.jsx)("option",{value:"viewer",children:"Viewer"}),(0,r.jsx)("option",{value:"user",children:"User"}),(0,r.jsx)("option",{value:"manager",children:"Manager"}),(0,r.jsx)("option",{value:"admin",children:"Admin"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[(0,r.jsx)(v.A,{className:"h-4 w-4 inline mr-1"}),"Tenant *"]}),(0,r.jsxs)("select",{required:!0,value:n.tenant_id,onChange:e=>j("tenant_id",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,r.jsx)("option",{value:"",children:"Select Tenant"}),l.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.name," (",e.tenant_type,")"]},e.id))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Permission Scope"}),(0,r.jsxs)("select",{value:n.permission_scope,onChange:e=>j("permission_scope",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,r.jsx)("option",{value:"own",children:"Own Data Only"}),(0,r.jsx)("option",{value:"tenant",children:"Tenant Scope"}),(0,r.jsx)("option",{value:"all",children:"All Data"})]})]})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"checkbox",id:"can_invite_users",checked:n.can_invite_users,onChange:e=>j("can_invite_users",e.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,r.jsx)("label",{htmlFor:"can_invite_users",className:"ml-2 text-sm text-gray-700",children:"Can invite other users"})]}),(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"checkbox",id:"can_manage_sub_clients",checked:n.can_manage_sub_clients,onChange:e=>j("can_manage_sub_clients",e.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,r.jsx)("label",{htmlFor:"can_manage_sub_clients",className:"ml-2 text-sm text-gray-700",children:"Can manage sub-client users"})]})]})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Authentication"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Temporary Password *"}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)("input",{type:"text",required:!0,value:n.password,onChange:e=>j("password",e.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter temporary password"}),(0,r.jsx)(c.$,{type:"button",onClick:()=>{let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*",s="";for(let t=0;t<12;t++)s+=e.charAt(Math.floor(Math.random()*e.length));d(e=>({...e,password:s}))},variant:"outline",children:"Generate"})]}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"User will be required to change password on first login"})]})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[(0,r.jsx)(c.$,{type:"button",variant:"outline",onClick:s,disabled:o,children:"Cancel"}),(0,r.jsx)(c.$,{type:"submit",disabled:o,children:o?"Creating...":"Create User"})]})]})})]})}):null}function R({isOpen:e,onClose:s,onSuccess:t,tenants:l}){let[n,d]=(0,a.useState)({emails:"",role:"user",role_level:"sub_client",tenant_id:"",message:"",expires_in_days:7}),[o,m]=(0,a.useState)(!1),[h,p]=(0,a.useState)(""),[g,b]=(0,a.useState)(0),y=(e,s)=>{d(t=>({...t,[e]:s})),"emails"===e&&b(s.split(/[,\n]/).filter(e=>e.trim().length>0).length)},f=e=>{let s=e.split(/[,\n]/).map(e=>e.trim()).filter(e=>e.length>0),t=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,r=[],a=[];if(s.forEach(e=>{t.test(e)?r.push(e):a.push(e)}),a.length>0)throw Error(`Invalid email addresses: ${a.join(", ")}`);return r},N=async e=>{e.preventDefault(),m(!0),p("");try{let e=f(n.emails);if(0===e.length)throw Error("Please enter at least one valid email address");if(!n.tenant_id)throw Error("Please select a tenant");let r={emails:e,role:n.role,role_level:n.role_level,tenant_id:n.tenant_id,message:n.message||void 0,expires_in_days:n.expires_in_days},a=await T.Lr.inviteUsers(r);a.success?(t(),s(),d({emails:"",role:"user",role_level:"sub_client",tenant_id:"",message:"",expires_in_days:7}),b(0)):p(a.error||"Failed to send invitations")}catch(e){p(e instanceof Error?e.message:"An error occurred while sending invitations"),console.error("Invitation error:",e)}finally{m(!1)}};return e?(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,r.jsxs)(i.Zp,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,r.jsx)(i.aR,{children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)(i.ZB,{className:"flex items-center",children:[(0,r.jsx)(u.A,{className:"h-5 w-5 mr-2"}),"Invite Users"]}),(0,r.jsx)(i.BT,{children:"Send email invitations to new users to join the platform"})]}),(0,r.jsx)(c.$,{variant:"outline",size:"sm",onClick:s,children:(0,r.jsx)(D.A,{className:"h-4 w-4"})})]})}),(0,r.jsx)(i.Wu,{children:(0,r.jsxs)("form",{onSubmit:N,className:"space-y-6",children:[h&&(0,r.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-3",children:(0,r.jsx)("p",{className:"text-sm text-red-600",children:h})}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Recipients"}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[(0,r.jsx)(u.A,{className:"h-4 w-4 inline mr-1"}),"Email Addresses *"]}),(0,r.jsx)("textarea",{required:!0,rows:4,value:n.emails,onChange:e=>y("emails",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter email addresses separated by commas or new lines: user1@company.com user2@company.com, user3@company.com"}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:g>0?`${g} email${g>1?"s":""} to be invited`:"Separate multiple emails with commas or new lines"})]})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Role Assignment"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[(0,r.jsx)(x.A,{className:"h-4 w-4 inline mr-1"}),"Role Level *"]}),(0,r.jsxs)("select",{required:!0,value:n.role_level,onChange:e=>y("role_level",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,r.jsx)("option",{value:"sub_client",children:"Sub Client"}),(0,r.jsx)("option",{value:"primary_client",children:"Primary Client"}),(0,r.jsx)("option",{value:"host",children:"Host Admin"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role *"}),(0,r.jsxs)("select",{required:!0,value:n.role,onChange:e=>y("role",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,r.jsx)("option",{value:"viewer",children:"Viewer"}),(0,r.jsx)("option",{value:"user",children:"User"}),(0,r.jsx)("option",{value:"manager",children:"Manager"}),(0,r.jsx)("option",{value:"admin",children:"Admin"})]})]}),(0,r.jsxs)("div",{className:"md:col-span-2",children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[(0,r.jsx)(v.A,{className:"h-4 w-4 inline mr-1"}),"Tenant *"]}),(0,r.jsxs)("select",{required:!0,value:n.tenant_id,onChange:e=>y("tenant_id",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,r.jsx)("option",{value:"",children:"Select Tenant"}),l.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.name," (",e.tenant_type,")"]},e.id))]})]})]})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Invitation Settings"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Expires In (Days)"}),(0,r.jsxs)("select",{value:n.expires_in_days,onChange:e=>y("expires_in_days",parseInt(e.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,r.jsx)("option",{value:1,children:"1 Day"}),(0,r.jsx)("option",{value:3,children:"3 Days"}),(0,r.jsx)("option",{value:7,children:"7 Days"}),(0,r.jsx)("option",{value:14,children:"14 Days"}),(0,r.jsx)("option",{value:30,children:"30 Days"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Custom Message"}),(0,r.jsx)("textarea",{rows:3,value:n.message,onChange:e=>y("message",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:(()=>{let e=l.find(e=>e.id===n.tenant_id);return`You have been invited to join ${e?.name||"our organization"} on the ETLA Platform. Please click the link below to accept your invitation and set up your account.`})()}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Leave blank to use the default invitation message"})]})]}),g>0&&n.tenant_id&&(0,r.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-4",children:[(0,r.jsxs)("h4",{className:"text-sm font-medium text-blue-900 mb-2",children:[(0,r.jsx)(j.A,{className:"h-4 w-4 inline mr-1"}),"Invitation Preview"]}),(0,r.jsxs)("div",{className:"text-sm text-blue-800",children:[(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:g})," user",g>1?"s":""," will be invited as ",(0,r.jsx)("strong",{children:n.role})," (",n.role_level,") to ",(0,r.jsx)("strong",{children:l.find(e=>e.id===n.tenant_id)?.name})]}),(0,r.jsxs)("p",{className:"mt-1",children:["Invitations will expire in ",(0,r.jsxs)("strong",{children:[n.expires_in_days," day",n.expires_in_days>1?"s":""]})]})]})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[(0,r.jsx)(c.$,{type:"button",variant:"outline",onClick:s,disabled:o,children:"Cancel"}),(0,r.jsxs)(c.$,{type:"submit",disabled:o||0===g,children:[(0,r.jsx)(C,{className:"h-4 w-4 mr-2"}),o?"Sending...":`Send ${g} Invitation${g>1?"s":""}`]})]})]})})]})}):null}var I=t(4771);function L({isOpen:e,onClose:s,onSuccess:t,user:l,tenants:n}){let[d,o]=(0,a.useState)({full_name:"",phone:"",department:"",job_title:"",role:"user",role_level:"sub_client",tenant_id:"",is_active:!0,can_invite_users:!1,can_manage_sub_clients:!1,permission_scope:"own"}),[m,u]=(0,a.useState)(!1),[h,p]=(0,a.useState)(""),j=(e,s)=>{if(o(t=>({...t,[e]:s})),"role_level"===e){let e="host"===s?"all":"primary_client"===s?"tenant":"own";o(s=>({...s,permission_scope:e}))}},g=async e=>{e.preventDefault(),u(!0),p("");try{if(!d.full_name||!d.tenant_id)return void p("Please fill in all required fields");let e={full_name:d.full_name,phone:d.phone||void 0,department:d.department||void 0,job_title:d.job_title||void 0,role:d.role,role_level:d.role_level,tenant_id:d.tenant_id,is_active:d.is_active,can_invite_users:d.can_invite_users,can_manage_sub_clients:d.can_manage_sub_clients,permission_scope:d.permission_scope},r=await T.Lr.updateUser(l.id,e);r.success?(t(),s()):p(r.error||"Failed to update user")}catch(e){p("An error occurred while updating the user"),console.error("User update error:",e)}finally{u(!1)}},b=async()=>{if(window.confirm("Are you sure you want to deactivate this user? They will lose access to the system.")){u(!0),p("");try{let e=await T.Lr.deactivateUser(l.id);e.success?(t(),s()):p(e.error||"Failed to deactivate user")}catch(e){p("An error occurred while deactivating the user"),console.error("User deactivation error:",e)}finally{u(!1)}}},y=async()=>{u(!0),p("");try{let e=await T.Lr.activateUser(l.id);e.success?(t(),s()):p(e.error||"Failed to activate user")}catch(e){p("An error occurred while activating the user"),console.error("User activation error:",e)}finally{u(!1)}};return e&&l?(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,r.jsxs)(i.Zp,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,r.jsx)(i.aR,{children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)(i.ZB,{className:"flex items-center",children:[(0,r.jsx)(U.A,{className:"h-5 w-5 mr-2"}),"Edit User: ",l.full_name]}),(0,r.jsx)(i.BT,{children:"Update user information, role, and permissions"})]}),(0,r.jsx)(c.$,{variant:"outline",size:"sm",onClick:s,children:(0,r.jsx)(D.A,{className:"h-4 w-4"})})]})}),(0,r.jsx)(i.Wu,{children:(0,r.jsxs)("form",{onSubmit:g,className:"space-y-6",children:[h&&(0,r.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-3",children:(0,r.jsx)("p",{className:"text-sm text-red-600",children:h})}),(0,r.jsx)("div",{className:"bg-gray-50 border border-gray-200 rounded-md p-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"text-sm font-medium text-gray-900",children:"Account Status"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:l.email})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${l.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:l.is_active?"Active":"Inactive"}),l.is_active?(0,r.jsx)(c.$,{type:"button",size:"sm",variant:"outline",onClick:b,disabled:m,children:"Deactivate"}):(0,r.jsx)(c.$,{type:"button",size:"sm",onClick:y,disabled:m,children:"Activate"})]})]})}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Basic Information"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[(0,r.jsx)(U.A,{className:"h-4 w-4 inline mr-1"}),"Full Name *"]}),(0,r.jsx)("input",{type:"text",required:!0,value:d.full_name,onChange:e=>j("full_name",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"John Doe"})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[(0,r.jsx)(P.A,{className:"h-4 w-4 inline mr-1"}),"Phone Number"]}),(0,r.jsx)("input",{type:"tel",value:d.phone,onChange:e=>j("phone",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"+1 (555) 123-4567"})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[(0,r.jsx)($.A,{className:"h-4 w-4 inline mr-1"}),"Job Title"]}),(0,r.jsx)("input",{type:"text",value:d.job_title,onChange:e=>j("job_title",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Software Engineer"})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[(0,r.jsx)(v.A,{className:"h-4 w-4 inline mr-1"}),"Department"]}),(0,r.jsx)("input",{type:"text",value:d.department,onChange:e=>j("department",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Engineering"})]})]})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Role and Permissions"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[(0,r.jsx)(x.A,{className:"h-4 w-4 inline mr-1"}),"Role Level *"]}),(0,r.jsxs)("select",{required:!0,value:d.role_level,onChange:e=>j("role_level",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,r.jsx)("option",{value:"sub_client",children:"Sub Client"}),(0,r.jsx)("option",{value:"primary_client",children:"Primary Client"}),(0,r.jsx)("option",{value:"host",children:"Host Admin"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role *"}),(0,r.jsxs)("select",{required:!0,value:d.role,onChange:e=>j("role",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,r.jsx)("option",{value:"viewer",children:"Viewer"}),(0,r.jsx)("option",{value:"user",children:"User"}),(0,r.jsx)("option",{value:"manager",children:"Manager"}),(0,r.jsx)("option",{value:"admin",children:"Admin"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[(0,r.jsx)(v.A,{className:"h-4 w-4 inline mr-1"}),"Tenant *"]}),(0,r.jsxs)("select",{required:!0,value:d.tenant_id,onChange:e=>j("tenant_id",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,r.jsx)("option",{value:"",children:"Select Tenant"}),n.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.name," (",e.tenant_type,")"]},e.id))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Permission Scope"}),(0,r.jsxs)("select",{value:d.permission_scope,onChange:e=>j("permission_scope",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,r.jsx)("option",{value:"own",children:"Own Data Only"}),(0,r.jsx)("option",{value:"tenant",children:"Tenant Scope"}),(0,r.jsx)("option",{value:"all",children:"All Data"})]})]})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"checkbox",id:"can_invite_users",checked:d.can_invite_users,onChange:e=>j("can_invite_users",e.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,r.jsx)("label",{htmlFor:"can_invite_users",className:"ml-2 text-sm text-gray-700",children:"Can invite other users"})]}),(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"checkbox",id:"can_manage_sub_clients",checked:d.can_manage_sub_clients,onChange:e=>j("can_manage_sub_clients",e.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,r.jsx)("label",{htmlFor:"can_manage_sub_clients",className:"ml-2 text-sm text-gray-700",children:"Can manage sub-client users"})]}),(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"checkbox",id:"is_active",checked:d.is_active,onChange:e=>j("is_active",e.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,r.jsx)("label",{htmlFor:"is_active",className:"ml-2 text-sm text-gray-700",children:"Account is active"})]})]})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[(0,r.jsx)(c.$,{type:"button",variant:"outline",onClick:s,disabled:m,children:"Cancel"}),(0,r.jsxs)(c.$,{type:"submit",disabled:m,children:[(0,r.jsx)(I.A,{className:"h-4 w-4 mr-2"}),m?"Saving...":"Save Changes"]})]})]})})]})}):null}function q({isOpen:e,onClose:s,onSuccess:t,user:l}){let[n,d]=(0,a.useState)(!1),[o,x]=(0,a.useState)(""),[h,p]=(0,a.useState)(!1),[j,b]=(0,a.useState)("email"),[v,y]=(0,a.useState)(""),f=async()=>{d(!0),x("");try{let e=await T.Lr.resetUserPassword(l.email);e.success?(p(!0),setTimeout(()=>{t(),w()},2e3)):x(e.error||"Failed to send password reset email")}catch(e){x(e.message||"Failed to send password reset email")}finally{d(!1)}},N=async()=>{if(!v||v.length<8)return void x("Password must be at least 8 characters long");d(!0),x("");try{let e=await T.Lr.resetUserPassword(l.email,v);e.success?(p(!0),setTimeout(()=>{t(),w()},2e3)):x(e.error||"Failed to reset password")}catch(e){x(e.message||"Failed to reset password")}finally{d(!1)}},w=()=>{x(""),p(!1),y(""),b("email"),s()};return e&&l?(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,r.jsxs)(i.Zp,{className:"w-full max-w-md",children:[(0,r.jsx)(i.aR,{children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)(i.ZB,{className:"flex items-center",children:[(0,r.jsx)(g.A,{className:"h-5 w-5 mr-2"}),"Reset Password"]}),(0,r.jsxs)(i.BT,{children:["Reset password for ",l.full_name]})]}),(0,r.jsx)(c.$,{variant:"outline",size:"sm",onClick:w,children:(0,r.jsx)(D.A,{className:"h-4 w-4"})})]})}),(0,r.jsxs)(i.Wu,{className:"space-y-6",children:[o&&(0,r.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-3",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(k.A,{className:"h-4 w-4 text-red-600 mr-2"}),(0,r.jsx)("p",{className:"text-sm text-red-600",children:o})]})}),h&&(0,r.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-md p-3",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(m.A,{className:"h-4 w-4 text-green-600 mr-2"}),(0,r.jsx)("p",{className:"text-sm text-green-600",children:"email"===j?"Password reset email sent successfully!":"Password reset successfully!"})]})}),!h&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"bg-gray-50 border border-gray-200 rounded-md p-3",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(u.A,{className:"h-4 w-4 text-gray-600 mr-2"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-900",children:l.full_name}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:l.email})]})]})}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:"Reset Method"}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"radio",id:"email_reset",name:"reset_method",value:"email",checked:"email"===j,onChange:e=>b(e.target.value),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300"}),(0,r.jsx)("label",{htmlFor:"email_reset",className:"ml-2 text-sm text-gray-700",children:"Send reset email to user"})]}),(0,r.jsx)("p",{className:"text-xs text-gray-500 ml-6",children:"User will receive an email with instructions to reset their password"}),(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"radio",id:"direct_reset",name:"reset_method",value:"direct",checked:"direct"===j,onChange:e=>b(e.target.value),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300"}),(0,r.jsx)("label",{htmlFor:"direct_reset",className:"ml-2 text-sm text-gray-700",children:"Set new password directly"})]}),(0,r.jsx)("p",{className:"text-xs text-gray-500 ml-6",children:"Set a temporary password that the user must change on next login"})]})]}),"direct"===j&&(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"New Temporary Password"}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)("input",{type:"text",value:v,onChange:e=>y(e.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter new password"}),(0,r.jsx)(c.$,{type:"button",onClick:()=>{let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*",s="";for(let t=0;t<12;t++)s+=e.charAt(Math.floor(Math.random()*e.length));y(s)},variant:"outline",size:"sm",children:"Generate"})]}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:"User will be required to change this password on their next login"})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[(0,r.jsx)(c.$,{variant:"outline",onClick:w,disabled:n,children:"Cancel"}),(0,r.jsx)(c.$,{onClick:"email"===j?f:N,disabled:n||"direct"===j&&!v,children:n?"Processing...":"email"===j?"Send Reset Email":"Reset Password"})]})]})]})]})}):null}var M=t(9712),B=t(761);function F({isOpen:e,onClose:s,onSuccess:t}){let[l,n]=(0,a.useState)(!1),[d,o]=(0,a.useState)(""),[x,u]=(0,a.useState)(!1),[h,p]=(0,a.useState)("options"),[g,b]=(0,a.useState)({deleteInactiveUsers:!1,deleteUnconfirmedUsers:!0,deleteExpiredInvites:!0,inactiveDays:90,unconfirmedDays:30}),[v,y]=(0,a.useState)(null),f=(e,s)=>{b(t=>({...t,[e]:s}))},N=async()=>{n(!0),o("");try{let e={deleteInactiveUsers:g.deleteInactiveUsers,deleteUnconfirmedUsers:g.deleteUnconfirmedUsers,deleteExpiredInvites:g.deleteExpiredInvites,inactiveDays:g.inactiveDays,unconfirmedDays:g.unconfirmedDays},s=await T.Lr.previewUserCleanup(e);s.success&&s.data?(y(s.data),p("preview")):o(s.error||"Failed to generate cleanup preview")}catch(e){o("An error occurred while generating the cleanup preview"),console.error("Cleanup preview error:",e)}finally{n(!1)}},w=async()=>{n(!0),o("");try{let e={deleteInactiveUsers:g.deleteInactiveUsers,deleteUnconfirmedUsers:g.deleteUnconfirmedUsers,deleteExpiredInvites:g.deleteExpiredInvites,inactiveDays:g.inactiveDays,unconfirmedDays:g.unconfirmedDays},s=await T.Lr.executeUserCleanup(e);s.success?(u(!0),setTimeout(()=>{t(),_()},3e3)):o(s.error||"Failed to execute cleanup")}catch(e){o("An error occurred while executing the cleanup"),console.error("Cleanup execution error:",e)}finally{n(!1)}},_=()=>{o(""),u(!1),p("options"),y(null),b({deleteInactiveUsers:!1,deleteUnconfirmedUsers:!0,deleteExpiredInvites:!0,inactiveDays:90,unconfirmedDays:30}),s()};return e?(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,r.jsxs)(i.Zp,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,r.jsx)(i.aR,{children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)(i.ZB,{className:"flex items-center",children:[(0,r.jsx)(M.A,{className:"h-5 w-5 mr-2"}),"User Cleanup Utility"]}),(0,r.jsx)(i.BT,{children:"Clean up inactive users, unconfirmed accounts, and expired invitations"})]}),(0,r.jsx)(c.$,{variant:"outline",size:"sm",onClick:_,children:(0,r.jsx)(D.A,{className:"h-4 w-4"})})]})}),(0,r.jsxs)(i.Wu,{className:"space-y-6",children:[d&&(0,r.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-3",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(k.A,{className:"h-4 w-4 text-red-600 mr-2"}),(0,r.jsx)("p",{className:"text-sm text-red-600",children:d})]})}),x&&(0,r.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-md p-3",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(m.A,{className:"h-4 w-4 text-green-600 mr-2"}),(0,r.jsx)("p",{className:"text-sm text-green-600",children:"User cleanup completed successfully! The system has been cleaned up."})]})}),!x&&(0,r.jsxs)(r.Fragment,{children:["options"===h&&(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-4",children:(0,r.jsxs)("div",{className:"flex items-start",children:[(0,r.jsx)(k.A,{className:"h-5 w-5 text-yellow-600 mr-2 mt-0.5"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"text-sm font-medium text-yellow-800",children:"Warning"}),(0,r.jsx)("p",{className:"text-sm text-yellow-700 mt-1",children:"This operation will permanently delete user accounts and cannot be undone. Please review your selections carefully."})]})]})}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Cleanup Options"}),(0,r.jsxs)("div",{className:"border border-gray-200 rounded-md p-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"checkbox",id:"deleteInactiveUsers",checked:g.deleteInactiveUsers,onChange:e=>f("deleteInactiveUsers",e.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,r.jsx)("label",{htmlFor:"deleteInactiveUsers",className:"ml-2 text-sm font-medium text-gray-900",children:"Delete inactive users"})]}),(0,r.jsx)(j.A,{className:"h-4 w-4 text-gray-400"})]}),(0,r.jsx)("p",{className:"text-sm text-gray-600 mb-3",children:"Remove users who haven't logged in for a specified period"}),g.deleteInactiveUsers&&(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("label",{className:"text-sm text-gray-700",children:"Inactive for more than:"}),(0,r.jsxs)("select",{value:g.inactiveDays,onChange:e=>f("inactiveDays",parseInt(e.target.value)),className:"px-2 py-1 border border-gray-300 rounded text-sm",children:[(0,r.jsx)("option",{value:30,children:"30 days"}),(0,r.jsx)("option",{value:60,children:"60 days"}),(0,r.jsx)("option",{value:90,children:"90 days"}),(0,r.jsx)("option",{value:180,children:"180 days"}),(0,r.jsx)("option",{value:365,children:"1 year"})]})]})]}),(0,r.jsxs)("div",{className:"border border-gray-200 rounded-md p-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"checkbox",id:"deleteUnconfirmedUsers",checked:g.deleteUnconfirmedUsers,onChange:e=>f("deleteUnconfirmedUsers",e.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,r.jsx)("label",{htmlFor:"deleteUnconfirmedUsers",className:"ml-2 text-sm font-medium text-gray-900",children:"Delete unconfirmed users"})]}),(0,r.jsx)(B.A,{className:"h-4 w-4 text-gray-400"})]}),(0,r.jsx)("p",{className:"text-sm text-gray-600 mb-3",children:"Remove users who haven't confirmed their email addresses"}),g.deleteUnconfirmedUsers&&(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("label",{className:"text-sm text-gray-700",children:"Created more than:"}),(0,r.jsxs)("select",{value:g.unconfirmedDays,onChange:e=>f("unconfirmedDays",parseInt(e.target.value)),className:"px-2 py-1 border border-gray-300 rounded text-sm",children:[(0,r.jsx)("option",{value:7,children:"7 days"}),(0,r.jsx)("option",{value:14,children:"14 days"}),(0,r.jsx)("option",{value:30,children:"30 days"}),(0,r.jsx)("option",{value:60,children:"60 days"})]}),(0,r.jsx)("span",{className:"text-sm text-gray-700",children:"ago"})]})]}),(0,r.jsxs)("div",{className:"border border-gray-200 rounded-md p-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"checkbox",id:"deleteExpiredInvites",checked:g.deleteExpiredInvites,onChange:e=>f("deleteExpiredInvites",e.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,r.jsx)("label",{htmlFor:"deleteExpiredInvites",className:"ml-2 text-sm font-medium text-gray-900",children:"Delete expired invitations"})]}),(0,r.jsx)(B.A,{className:"h-4 w-4 text-gray-400"})]}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Remove invitation records that have expired and are no longer valid"})]})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[(0,r.jsx)(c.$,{variant:"outline",onClick:_,disabled:l,children:"Cancel"}),(0,r.jsx)(c.$,{onClick:N,disabled:l||!g.deleteInactiveUsers&&!g.deleteUnconfirmedUsers&&!g.deleteExpiredInvites,children:l?"Generating...":"Preview Cleanup"})]})]}),"preview"===h&&v&&(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-4",children:[(0,r.jsx)("h4",{className:"text-sm font-medium text-blue-800 mb-2",children:"Cleanup Preview"}),(0,r.jsx)("p",{className:"text-sm text-blue-700",children:"Review what will be deleted before proceeding with the cleanup."})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[g.deleteInactiveUsers&&(0,r.jsx)("div",{className:"bg-gray-50 border border-gray-200 rounded-md p-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)(j.A,{className:"h-8 w-8 text-gray-600"}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:v.inactiveUsers}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Inactive Users"})]})]})}),g.deleteUnconfirmedUsers&&(0,r.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)(B.A,{className:"h-8 w-8 text-yellow-600"}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsx)("p",{className:"text-2xl font-bold text-yellow-900",children:v.unconfirmedUsers}),(0,r.jsx)("p",{className:"text-sm text-yellow-700",children:"Unconfirmed Users"})]})]})}),g.deleteExpiredInvites&&(0,r.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)(A.A,{className:"h-8 w-8 text-red-600"}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsx)("p",{className:"text-2xl font-bold text-red-900",children:v.expiredInvites}),(0,r.jsx)("p",{className:"text-sm text-red-700",children:"Expired Invites"})]})]})})]}),(0,r.jsx)("div",{className:"bg-gray-900 text-white rounded-md p-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"text-lg font-medium",children:"Total items to be deleted:"}),(0,r.jsx)("span",{className:"text-2xl font-bold",children:v.totalToDelete})]})}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[(0,r.jsx)(c.$,{variant:"outline",onClick:()=>p("options"),disabled:l,children:"Back"}),(0,r.jsx)(c.$,{onClick:()=>p("confirm"),disabled:l||0===v.totalToDelete,variant:v.totalToDelete>0?"destructive":"outline",children:v.totalToDelete>0?"Proceed to Confirm":"Nothing to Clean"})]})]}),"confirm"===h&&v&&(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:(0,r.jsxs)("div",{className:"flex items-start",children:[(0,r.jsx)(k.A,{className:"h-5 w-5 text-red-600 mr-2 mt-0.5"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"text-sm font-medium text-red-800",children:"Final Confirmation"}),(0,r.jsxs)("p",{className:"text-sm text-red-700 mt-1",children:["You are about to permanently delete ",(0,r.jsx)("strong",{children:v.totalToDelete})," items from the system. This action cannot be undone."]})]})]})}),(0,r.jsxs)("div",{className:"bg-white border border-gray-200 rounded-md p-4",children:[(0,r.jsx)("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"Summary of actions:"}),(0,r.jsxs)("ul",{className:"space-y-2 text-sm text-gray-600",children:[g.deleteInactiveUsers&&(0,r.jsxs)("li",{children:["• Delete ",v.inactiveUsers," users inactive for more than ",g.inactiveDays," days"]}),g.deleteUnconfirmedUsers&&(0,r.jsxs)("li",{children:["• Delete ",v.unconfirmedUsers," unconfirmed users created more than ",g.unconfirmedDays," days ago"]}),g.deleteExpiredInvites&&(0,r.jsxs)("li",{children:["• Delete ",v.expiredInvites," expired invitation records"]})]})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[(0,r.jsx)(c.$,{variant:"outline",onClick:()=>p("preview"),disabled:l,children:"Back"}),(0,r.jsx)(c.$,{onClick:w,disabled:l,variant:"destructive",children:l?"Executing Cleanup...":"Execute Cleanup"})]})]})]})]})]})}):null}function Z(){let{user:e,isAuthenticated:s,tenant:t}=(0,l.h)(),{hasPermission:N,currentRole:U,isHostAdmin:D}=(0,S.Sk)(),[P,$]=(0,a.useState)([]),[I,M]=(0,a.useState)([]),[B,Z]=(0,a.useState)([]),[z,O]=(0,a.useState)([]),[W,H]=(0,a.useState)(!0),[G,V]=(0,a.useState)(""),[J,Y]=(0,a.useState)(""),[K,X]=(0,a.useState)("all"),[Q,ee]=(0,a.useState)("all"),[es,et]=(0,a.useState)("overview"),[er,ea]=(0,a.useState)(!1),[el,en]=(0,a.useState)(!1),[ei,ec]=(0,a.useState)(!1),[ed,eo]=(0,a.useState)(!1),[em,ex]=(0,a.useState)(!1),[eu,eh]=(0,a.useState)(null),ep=N("user-management","manage")&&D(),ej=N("user-management","view")||ep,eg=async()=>{H(!0);try{await Promise.all([eb(),ev(),ey(),ef()])}catch(e){console.error("Error loading data:",e)}finally{H(!1)}},eb=async()=>{try{let{data:e,error:s}=await T.ND.from("profiles").select(`
          *,
          tenant_users!inner(
            role,
            role_level,
            is_active,
            tenant_id,
            tenants(name)
          )
        `).order("created_at",{ascending:!1});if(s)throw s;let t=e?.map(e=>({id:e.id,email:e.email||"N/A",full_name:e.full_name||"Unknown",role:e.tenant_users[0]?.role||"user",role_level:e.tenant_users[0]?.role_level||"sub_client",tenant_name:e.tenant_users[0]?.tenants?.name||"No Tenant",tenant_id:e.tenant_users[0]?.tenant_id,is_active:e.tenant_users[0]?.is_active??!0,created_at:e.created_at,last_sign_in_at:e.last_sign_in_at,phone:e.phone,department:e.department,job_title:e.job_title,can_invite_users:["admin","manager"].includes(e.tenant_users[0]?.role||""),can_manage_sub_clients:e.tenant_users[0]?.role_level==="primary_client",permission_scope:e.tenant_users[0]?.permission_scope||"own"}))||[];$(t)}catch(e){console.error("Error loading users:",e),V("Failed to load users")}},ev=async()=>{try{let{data:e,error:s}=await T.ND.from("tenants").select("*").order("name");if(s)throw s;M(e||[])}catch(e){console.error("Error loading tenants:",e),V("Failed to load tenants")}},ey=async()=>{try{Z([])}catch(e){console.error("Error loading invites:",e),V("Failed to load invites")}},ef=async()=>{try{let{data:e,error:s}=await T.ND.from("tenant_users").select("role, role_level");if(s)throw s;let t=Object.entries(e?.reduce((e,s)=>{let t=`${s.role_level}_${s.role}`;return e[t]=(e[t]||0)+1,e},{})||{}).map(([e,s])=>{let[t,r]=e.split("_");return{role:r,role_level:t,count:s,description:`${t} ${r}s`}});O(t)}catch(e){console.error("Error loading role stats:",e),V("Failed to load role stats")}},eN=async e=>{if(window.confirm("Are you sure you want to delete this user? This action cannot be undone."))try{let{error:s}=await T.ND.from("tenant_users").delete().eq("user_id",e);if(s)throw s;let{error:t}=await T.ND.from("profiles").delete().eq("id",e);if(t)throw t;console.log("User deleted from profiles and tenant_users. Auth user may need manual cleanup."),await eb()}catch(e){console.error("Error deleting user:",e),V("Failed to delete user")}},ew=(e,s)=>{eh(P.find(s=>s.id===e)||null),eo(!0)},e_=async e=>{try{console.log("Resending invite:",e),await ey()}catch(e){console.error("Error resending invite:",e),V("Failed to resend invite")}},eA=()=>{let e=new Blob([["Email,Name,Role,Level,Tenant,Status,Last Login,Created",...ek.map(e=>[e.email,e.full_name,e.role,e.role_level,e.tenant_name,e.is_active?"Active":"Inactive",e.last_sign_in_at?new Date(e.last_sign_in_at).toLocaleDateString():"Never",new Date(e.created_at).toLocaleDateString()].join(","))].join("\n")],{type:"text/csv"}),s=window.URL.createObjectURL(e),t=document.createElement("a");t.href=s,t.download=`users-export-${new Date().toISOString().split("T")[0]}.csv`,t.click(),window.URL.revokeObjectURL(s)},ek=P.filter(e=>{let s=e.email.toLowerCase().includes(J.toLowerCase())||e.full_name.toLowerCase().includes(J.toLowerCase()),t="all"===K||e.tenant_id===K,r="all"===Q||e.role===Q;return s&&t&&r}),eC=(e,s)=>"host"===s?"bg-purple-100 text-purple-800":"primary_client"===s?"bg-blue-100 text-blue-800":"sub_client"===s?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800",eS=e=>e.email_confirmed_at?e.is_active?(0,r.jsx)(m.A,{className:"h-4 w-4 text-green-500"}):(0,r.jsx)(o.A,{className:"h-4 w-4 text-red-500"}):(0,r.jsx)(d.A,{className:"h-4 w-4 text-yellow-500"});return s?ej?(0,r.jsxs)(n.A,{children:[(0,r.jsxs)("div",{className:"p-6 lg:p-8",children:[(0,r.jsx)("div",{className:"mb-8",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Access Control & Security"}),(0,r.jsx)("p",{className:"mt-2 text-gray-600",children:ep?"Comprehensive user management, RBAC, and security controls":`User management and security overview for ${t?.name}`})]}),ep&&(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsxs)(c.$,{onClick:()=>en(!0),variant:"outline",children:[(0,r.jsx)(u.A,{className:"h-4 w-4 mr-2"}),"Invite User"]}),(0,r.jsxs)(c.$,{onClick:()=>ea(!0),children:[(0,r.jsx)(h.A,{className:"h-4 w-4 mr-2"}),"Create User"]})]})]})}),(0,r.jsx)("div",{className:"border-b border-gray-200 mb-6",children:(0,r.jsx)("nav",{className:"-mb-px flex space-x-8",children:[{id:"overview",label:"Overview",icon:p.A},{id:"users",label:"Users",icon:j.A},{id:"roles",label:"Roles & Permissions",icon:x.A},{id:"sso",label:"SSO Configuration",icon:g.A},...ep?[{id:"invites",label:"Invitations",icon:u.A},{id:"cleanup",label:"System Cleanup",icon:b.A}]:[]].map(({id:e,label:s,icon:t})=>(0,r.jsxs)("button",{onClick:()=>et(e),className:`flex items-center py-2 px-1 border-b-2 font-medium text-sm ${es===e?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[(0,r.jsx)(t,{className:"h-4 w-4 mr-2"}),s]},e))})}),"overview"===es&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[(0,r.jsx)(i.Zp,{children:(0,r.jsx)(i.Wu,{className:"p-6",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Users"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:P.length})]}),(0,r.jsx)(j.A,{className:"h-8 w-8 text-blue-600"})]})})}),(0,r.jsx)(i.Zp,{children:(0,r.jsx)(i.Wu,{className:"p-6",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Active Tenants"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:I.filter(e=>"active"===e.status).length})]}),(0,r.jsx)(v.A,{className:"h-8 w-8 text-green-600"})]})})}),(0,r.jsx)(i.Zp,{children:(0,r.jsx)(i.Wu,{className:"p-6",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Pending Invites"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:B.filter(e=>"pending"===e.status).length})]}),(0,r.jsx)(u.A,{className:"h-8 w-8 text-yellow-600"})]})})}),(0,r.jsx)(i.Zp,{children:(0,r.jsx)(i.Wu,{className:"p-6",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Active Users"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:P.filter(e=>e.is_active).length})]}),(0,r.jsx)(m.A,{className:"h-8 w-8 text-purple-600"})]})})})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[(0,r.jsxs)(i.Zp,{children:[(0,r.jsxs)(i.aR,{children:[(0,r.jsx)(i.ZB,{children:"Role Distribution"}),(0,r.jsx)(i.BT,{children:"Current user distribution across roles and levels"})]}),(0,r.jsx)(i.Wu,{children:(0,r.jsx)("div",{className:"space-y-4",children:z.map((e,s)=>(0,r.jsxs)("div",{className:"border border-gray-200 rounded-lg p-3",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(x.A,{className:`h-4 w-4 mr-2 ${"host"===e.role_level?"text-purple-600":"primary_client"===e.role_level?"text-blue-600":"text-green-600"}`}),(0,r.jsxs)("span",{className:"text-sm font-medium",children:[e.role," (",e.role_level,")"]})]}),(0,r.jsxs)("span",{className:"text-sm font-bold text-gray-900",children:[e.count," users"]})]}),(0,r.jsx)("p",{className:"text-xs text-gray-600",children:e.description})]},s))})})]}),(0,r.jsxs)(i.Zp,{children:[(0,r.jsxs)(i.aR,{children:[(0,r.jsx)(i.ZB,{children:"Tenant Overview"}),(0,r.jsx)(i.BT,{children:"Active tenants and user distribution"})]}),(0,r.jsx)(i.Wu,{children:(0,r.jsx)("div",{className:"space-y-3",children:I.slice(0,5).map(e=>(0,r.jsxs)("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium text-gray-900",children:e.name}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:e.tenant_type})]}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsxs)("p",{className:"font-medium",children:[e.user_count," users"]}),(0,r.jsx)("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${"active"===e.status?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:e.status})]})]},e.id))})})]})]})]}),"users"===es&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[(0,r.jsx)("div",{className:"flex-1",children:(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(y.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),(0,r.jsx)("input",{type:"text",placeholder:"Search users by email or name...",value:J,onChange:e=>Y(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),(0,r.jsxs)("select",{value:K,onChange:e=>X(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,r.jsx)("option",{value:"all",children:"All Tenants"}),I.map(e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,r.jsxs)("select",{value:Q,onChange:e=>ee(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,r.jsx)("option",{value:"all",children:"All Roles"}),(0,r.jsx)("option",{value:"admin",children:"Admin"}),(0,r.jsx)("option",{value:"manager",children:"Manager"}),(0,r.jsx)("option",{value:"user",children:"User"}),(0,r.jsx)("option",{value:"viewer",children:"Viewer"})]}),(0,r.jsxs)(c.$,{onClick:eA,variant:"outline",children:[(0,r.jsx)(f.A,{className:"h-4 w-4 mr-2"}),"Export"]})]}),(0,r.jsxs)(i.Zp,{children:[(0,r.jsxs)(i.aR,{children:[(0,r.jsxs)(i.ZB,{children:["Users (",ek.length,")"]}),(0,r.jsx)(i.BT,{children:ep?"Manage all users across the platform":"View users in your organization"})]}),(0,r.jsx)(i.Wu,{children:W?(0,r.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,r.jsx)(w,{className:"h-6 w-6 animate-spin text-gray-400"}),(0,r.jsx)("span",{className:"ml-2 text-gray-600",children:"Loading users..."})]}):(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"border-b",children:[(0,r.jsx)("th",{className:"text-left py-3 px-4 font-medium text-gray-900",children:"User"}),(0,r.jsx)("th",{className:"text-left py-3 px-4 font-medium text-gray-900",children:"Role"}),(0,r.jsx)("th",{className:"text-left py-3 px-4 font-medium text-gray-900",children:"Tenant"}),(0,r.jsx)("th",{className:"text-left py-3 px-4 font-medium text-gray-900",children:"Status"}),(0,r.jsx)("th",{className:"text-left py-3 px-4 font-medium text-gray-900",children:"Last Login"}),ep&&(0,r.jsx)("th",{className:"text-left py-3 px-4 font-medium text-gray-900",children:"Actions"})]})}),(0,r.jsx)("tbody",{children:ek.map(e=>(0,r.jsxs)("tr",{className:"border-b hover:bg-gray-50",children:[(0,r.jsx)("td",{className:"py-3 px-4",children:(0,r.jsxs)("div",{className:"flex items-center",children:[eS(e),(0,r.jsxs)("div",{className:"ml-3",children:[(0,r.jsx)("p",{className:"font-medium text-gray-900",children:e.full_name}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:e.email}),e.job_title&&(0,r.jsx)("p",{className:"text-xs text-gray-500",children:e.job_title})]})]})}),(0,r.jsx)("td",{className:"py-3 px-4",children:(0,r.jsxs)("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${eC(e.role,e.role_level)}`,children:[e.role," (",e.role_level,")"]})}),(0,r.jsx)("td",{className:"py-3 px-4",children:(0,r.jsx)("p",{className:"text-sm text-gray-900",children:e.tenant_name})}),(0,r.jsx)("td",{className:"py-3 px-4",children:(0,r.jsx)("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${e.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:e.is_active?"Active":"Inactive"})}),(0,r.jsx)("td",{className:"py-3 px-4",children:(0,r.jsx)("p",{className:"text-sm text-gray-600",children:e.last_sign_in_at?new Date(e.last_sign_in_at).toLocaleDateString():"Never"})}),ep&&(0,r.jsx)("td",{className:"py-3 px-4",children:(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(c.$,{size:"sm",variant:"outline",onClick:()=>{eh(e),ec(!0)},children:(0,r.jsx)(_.A,{className:"h-3 w-3"})}),(0,r.jsx)(c.$,{size:"sm",variant:"outline",onClick:()=>ew(e.id,e.email),children:(0,r.jsx)(g.A,{className:"h-3 w-3"})}),(0,r.jsx)(c.$,{size:"sm",variant:"outline",onClick:()=>eN(e.id),className:"text-red-600 hover:text-red-700",children:(0,r.jsx)(A.A,{className:"h-3 w-3"})})]})})]},e.id))})]})})})]})]}),"roles"===es&&(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,r.jsxs)(i.Zp,{children:[(0,r.jsxs)(i.aR,{children:[(0,r.jsx)(i.ZB,{children:"Role-Based Access Control (RBAC)"}),(0,r.jsx)(i.BT,{children:"Manage user roles and permissions with tenant scoping"})]}),(0,r.jsxs)(i.Wu,{children:[(0,r.jsx)("div",{className:"space-y-4",children:z.map((e,s)=>(0,r.jsxs)("div",{className:"border border-gray-200 rounded-lg p-3",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(x.A,{className:`h-4 w-4 mr-2 ${"host"===e.role_level?"text-red-600":"primary_client"===e.role_level?"text-orange-600":"sub_client"===e.role_level?"text-blue-600":"text-green-600"}`}),(0,r.jsx)("span",{className:"text-sm font-medium",children:e.role})]}),ep&&(0,r.jsxs)("div",{className:"flex space-x-1",children:[(0,r.jsx)(c.$,{size:"sm",variant:"outline",children:(0,r.jsx)(_.A,{className:"h-3 w-3"})}),(0,r.jsx)(c.$,{size:"sm",variant:"outline",children:(0,r.jsx)(A.A,{className:"h-3 w-3"})})]})]}),(0,r.jsx)("p",{className:"text-xs text-gray-600 mb-2",children:e.description}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("span",{className:"text-xs text-gray-500",children:[e.count," users assigned"]}),(0,r.jsx)("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${"host"===e.role_level?"bg-red-50 text-red-700 border border-red-200":"primary_client"===e.role_level?"bg-orange-50 text-orange-700 border border-orange-200":"sub_client"===e.role_level?"bg-blue-50 text-blue-700 border border-blue-200":"bg-green-50 text-green-700 border border-green-200"}`,children:"host"===e.role_level?"System-wide":"primary_client"===e.role_level?"Tenant-scoped":"sub_client"===e.role_level?"Sub-client":"Limited"})]})]},s))}),ep&&(0,r.jsx)("div",{className:"mt-4 pt-4 border-t",children:(0,r.jsx)(c.$,{size:"sm",variant:"outline",className:"w-full",children:"Create Custom Role"})})]})]}),(0,r.jsxs)(i.Zp,{children:[(0,r.jsxs)(i.aR,{children:[(0,r.jsx)(i.ZB,{children:"Permission Matrix"}),(0,r.jsx)(i.BT,{children:"Overview of permissions by role level"})]}),(0,r.jsx)(i.Wu,{children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-4 gap-2 text-xs font-medium text-gray-600 border-b pb-2",children:[(0,r.jsx)("div",{children:"Permission"}),(0,r.jsx)("div",{children:"Host"}),(0,r.jsx)("div",{children:"Primary"}),(0,r.jsx)("div",{children:"Sub"})]}),[{name:"User Management",host:!0,primary:!0,sub:!1},{name:"System Settings",host:!0,primary:!1,sub:!1},{name:"Tenant Management",host:!0,primary:!0,sub:!1},{name:"Project Management",host:!0,primary:!0,sub:!0},{name:"Reporting",host:!0,primary:!0,sub:!0},{name:"Data Export",host:!0,primary:!0,sub:!1}].map((e,s)=>(0,r.jsxs)("div",{className:"grid grid-cols-4 gap-2 text-xs py-2 border-b",children:[(0,r.jsx)("div",{className:"font-medium",children:e.name}),(0,r.jsx)("div",{className:"text-center",children:e.host?(0,r.jsx)(m.A,{className:"h-4 w-4 text-green-500 mx-auto"}):(0,r.jsx)(o.A,{className:"h-4 w-4 text-red-500 mx-auto"})}),(0,r.jsx)("div",{className:"text-center",children:e.primary?(0,r.jsx)(m.A,{className:"h-4 w-4 text-green-500 mx-auto"}):(0,r.jsx)(o.A,{className:"h-4 w-4 text-red-500 mx-auto"})}),(0,r.jsx)("div",{className:"text-center",children:e.sub?(0,r.jsx)(m.A,{className:"h-4 w-4 text-green-500 mx-auto"}):(0,r.jsx)(o.A,{className:"h-4 w-4 text-red-500 mx-auto"})})]},s))]})})]})]}),"sso"===es&&(0,r.jsxs)(i.Zp,{children:[(0,r.jsxs)(i.aR,{children:[(0,r.jsx)(i.ZB,{children:"Single Sign-On (SSO)"}),(0,r.jsx)(i.BT,{children:"Configure SSO providers and authentication settings"})]}),(0,r.jsxs)(i.Wu,{children:[(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"border border-green-200 rounded-lg p-3 bg-green-50",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(m.A,{className:"h-4 w-4 text-green-600 mr-2"}),(0,r.jsx)("span",{className:"text-sm font-medium",children:"Microsoft Azure AD"})]}),(0,r.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 border border-green-200",children:"Active"})]}),(0,r.jsx)("p",{className:"text-xs text-green-700 mb-2",children:"Primary SSO provider for corporate users"}),(0,r.jsxs)("div",{className:"text-xs text-green-600",children:["Last sync: ",new Date().toLocaleDateString()," | ",P.filter(e=>e.email.includes("@")).length," users authenticated"]})]}),(0,r.jsxs)("div",{className:"border border-blue-200 rounded-lg p-3 bg-blue-50",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(m.A,{className:"h-4 w-4 text-blue-600 mr-2"}),(0,r.jsx)("span",{className:"text-sm font-medium",children:"Google Workspace"})]}),(0,r.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 border border-blue-200",children:"Active"})]}),(0,r.jsx)("p",{className:"text-xs text-blue-700 mb-2",children:"Secondary provider for external consultants"}),(0,r.jsxs)("div",{className:"text-xs text-blue-600",children:["Last sync: ",new Date().toLocaleDateString()," | ",Math.floor(.2*P.length)," users authenticated"]})]}),(0,r.jsxs)("div",{className:"border border-gray-200 rounded-lg p-3",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(k.A,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,r.jsx)("span",{className:"text-sm font-medium",children:"SAML 2.0 Provider"})]}),(0,r.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800 border border-gray-200",children:"Configured"})]}),(0,r.jsx)("p",{className:"text-xs text-gray-600 mb-2",children:"Ready for enterprise SAML integration"}),(0,r.jsx)("div",{className:"text-xs text-gray-500",children:"Status: Ready | No active connections"})]})]}),ep&&(0,r.jsx)("div",{className:"mt-4 pt-4 border-t",children:(0,r.jsx)(c.$,{size:"sm",variant:"outline",className:"w-full",children:"Configure SSO Provider"})})]})]}),"invites"===es&&ep&&(0,r.jsxs)(i.Zp,{children:[(0,r.jsxs)(i.aR,{children:[(0,r.jsx)(i.ZB,{children:"Pending Invitations"}),(0,r.jsx)(i.BT,{children:"Manage user invitations and track their status"})]}),(0,r.jsx)(i.Wu,{children:(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"border-b",children:[(0,r.jsx)("th",{className:"text-left py-3 px-4 font-medium text-gray-900",children:"Email"}),(0,r.jsx)("th",{className:"text-left py-3 px-4 font-medium text-gray-900",children:"Role"}),(0,r.jsx)("th",{className:"text-left py-3 px-4 font-medium text-gray-900",children:"Tenant"}),(0,r.jsx)("th",{className:"text-left py-3 px-4 font-medium text-gray-900",children:"Invited By"}),(0,r.jsx)("th",{className:"text-left py-3 px-4 font-medium text-gray-900",children:"Status"}),(0,r.jsx)("th",{className:"text-left py-3 px-4 font-medium text-gray-900",children:"Expires"}),(0,r.jsx)("th",{className:"text-left py-3 px-4 font-medium text-gray-900",children:"Actions"})]})}),(0,r.jsx)("tbody",{children:B.map(e=>(0,r.jsxs)("tr",{className:"border-b hover:bg-gray-50",children:[(0,r.jsx)("td",{className:"py-3 px-4 font-medium",children:e.email}),(0,r.jsx)("td",{className:"py-3 px-4",children:e.role}),(0,r.jsx)("td",{className:"py-3 px-4",children:e.tenant_name}),(0,r.jsx)("td",{className:"py-3 px-4",children:e.invited_by}),(0,r.jsx)("td",{className:"py-3 px-4",children:(0,r.jsx)("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${"pending"===e.status?"bg-yellow-100 text-yellow-800":"accepted"===e.status?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:e.status})}),(0,r.jsx)("td",{className:"py-3 px-4",children:new Date(e.expires_at).toLocaleDateString()}),(0,r.jsx)("td",{className:"py-3 px-4",children:"pending"===e.status&&(0,r.jsxs)(c.$,{size:"sm",variant:"outline",onClick:()=>e_(e.id),children:[(0,r.jsx)(C,{className:"h-3 w-3 mr-1"}),"Resend"]})})]},e.id))})]})})})]}),"cleanup"===es&&ep&&(0,r.jsxs)(i.Zp,{children:[(0,r.jsxs)(i.aR,{children:[(0,r.jsx)(i.ZB,{children:"System Cleanup & Maintenance"}),(0,r.jsx)(i.BT,{children:"Advanced user management and cleanup operations"})]}),(0,r.jsx)(i.Wu,{children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)(c.$,{onClick:()=>ex(!0),variant:"outline",className:"w-full justify-start",children:[(0,r.jsx)(A.A,{className:"h-4 w-4 mr-2"}),"Bulk User Cleanup"]}),(0,r.jsxs)(c.$,{onClick:eg,variant:"outline",className:"w-full justify-start",children:[(0,r.jsx)(w,{className:"h-4 w-4 mr-2"}),"Refresh All Data"]}),(0,r.jsxs)(c.$,{onClick:eA,variant:"outline",className:"w-full justify-start",children:[(0,r.jsx)(f.A,{className:"h-4 w-4 mr-2"}),"Export User Data"]})]})})]})]}),ep&&(0,r.jsxs)(r.Fragment,{children:[er&&(0,r.jsx)(E,{isOpen:er,onClose:()=>ea(!1),onSuccess:eb,tenants:I}),el&&(0,r.jsx)(R,{isOpen:el,onClose:()=>en(!1),onSuccess:ey,tenants:I}),ei&&eu&&(0,r.jsx)(L,{isOpen:ei,onClose:()=>{ec(!1),eh(null)},onSuccess:eb,user:eu,tenants:I}),ed&&eu&&(0,r.jsx)(q,{isOpen:ed,onClose:()=>{eo(!1),eh(null)},onSuccess:()=>{eb(),eo(!1),eh(null)},user:eu}),em&&(0,r.jsx)(F,{isOpen:em,onClose:()=>ex(!1),onSuccess:eb})]})]}):(0,r.jsx)(n.A,{children:(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsx)(i.Zp,{className:"w-96",children:(0,r.jsxs)(i.Wu,{className:"p-6 text-center",children:[(0,r.jsx)(o.A,{className:"h-12 w-12 text-red-400 mx-auto mb-4"}),(0,r.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Access Denied"}),(0,r.jsx)("p",{className:"text-gray-600",children:"You don't have permission to access user management."}),(0,r.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"Contact your administrator for access."})]})})})}):(0,r.jsx)(n.A,{children:(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsx)(i.Zp,{className:"w-96",children:(0,r.jsxs)(i.Wu,{className:"p-6 text-center",children:[(0,r.jsx)(x.A,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,r.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Authentication Required"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Please log in to access user management."})]})})})})}},5591:e=>{"use strict";e.exports=require("https")},6228:(e,s,t)=>{"use strict";t.d(s,{A:()=>r});let r=(0,t(9377).A)("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]])},6973:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>r});let r=(0,t(2907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/home/ubuntu/ETLA-Platform/frontend/src/app/access-control/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/ubuntu/ETLA-Platform/frontend/src/app/access-control/page.tsx","default")},7907:(e,s,t)=>{Promise.resolve().then(t.bind(t,5545))},7910:e=>{"use strict";e.exports=require("stream")},8520:(e,s,t)=>{"use strict";t.d(s,{A:()=>r});let r=(0,t(9377).A)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},9082:(e,s,t)=>{"use strict";t.d(s,{A:()=>r});let r=(0,t(9377).A)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},9121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9551:e=>{"use strict";e.exports=require("url")},9720:(e,s,t)=>{"use strict";t.d(s,{A:()=>r});let r=(0,t(9377).A)("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},9987:(e,s,t)=>{"use strict";t.d(s,{A:()=>r});let r=(0,t(9377).A)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])}};var s=require("../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[197,147,897,165],()=>t(3323));module.exports=r})();