(()=>{var e={};e.id=957,e.ids=[957],e.modules={515:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,pages:()=>c,routeModule:()=>u,tree:()=>o});var s=r(5239),a=r(8088),n=r(8170),i=r.n(n),l=r(893),d={};for(let e in l)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>l[e]);r.d(t,d);let o={children:["",{children:["admin",{children:["tenant-management",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,755)),"/home/ubuntu/ETLA-Platform/frontend/src/app/admin/tenant-management/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,4431)),"/home/ubuntu/ETLA-Platform/frontend/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,7398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,9999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,5284,23)),"next/dist/client/components/unauthorized-error"]}]}.children,c=["/home/ubuntu/ETLA-Platform/frontend/src/app/admin/tenant-management/page.tsx"],m={require:r,loadChunk:()=>Promise.resolve()},u=new s.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/admin/tenant-management/page",pathname:"/admin/tenant-management",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},755:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});let s=(0,r(2907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/home/ubuntu/ETLA-Platform/frontend/src/app/admin/tenant-management/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/ubuntu/ETLA-Platform/frontend/src/app/admin/tenant-management/page.tsx","default")},846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},983:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(9377).A)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},1630:e=>{"use strict";e.exports=require("http")},1787:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(9377).A)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},1907:(e,t,r)=>{"use strict";r.d(t,{p:()=>i});var s=r(687),a=r(3210),n=r(4780);let i=a.forwardRef(({className:e,type:t,...r},a)=>(0,s.jsx)("input",{type:t,className:(0,n.cn)("flex h-10 w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm ring-offset-white file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-gray-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:a,...r}));i.displayName="Input"},1997:e=>{"use strict";e.exports=require("punycode")},2643:(e,t,r)=>{"use strict";r.d(t,{$:()=>i});var s=r(687),a=r(3210),n=r(4780);let i=a.forwardRef(({className:e,variant:t="default",size:r="default",...a},i)=>(0,s.jsx)("button",{className:(0,n.cn)("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-white transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{"bg-blue-600 text-white hover:bg-blue-700":"default"===t,"bg-red-600 text-white hover:bg-red-700":"destructive"===t,"border border-gray-300 bg-white hover:bg-gray-50":"outline"===t,"bg-gray-100 text-gray-900 hover:bg-gray-200":"secondary"===t,"hover:bg-gray-100":"ghost"===t,"text-blue-600 underline-offset-4 hover:underline":"link"===t},{"h-10 px-4 py-2":"default"===r,"h-9 rounded-md px-3":"sm"===r,"h-11 rounded-md px-8":"lg"===r,"h-10 w-10":"icon"===r},e),ref:i,...a}));i.displayName="Button"},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3873:e=>{"use strict";e.exports=require("path")},4075:e=>{"use strict";e.exports=require("zlib")},4463:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(9377).A)("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]])},4780:(e,t,r)=>{"use strict";r.d(t,{cn:()=>n});var s=r(9384),a=r(2348);function n(...e){return(0,a.QP)((0,s.$)(e))}},5591:e=>{"use strict";e.exports=require("https")},5713:(e,t,r)=>{Promise.resolve().then(r.bind(r,755))},5985:(e,t,r)=>{Promise.resolve().then(r.bind(r,9805))},6073:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(9377).A)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]])},7910:e=>{"use strict";e.exports=require("stream")},8749:(e,t,r)=>{"use strict";r.d(t,{BT:()=>o,Wu:()=>c,ZB:()=>d,Zp:()=>i,aR:()=>l});var s=r(687),a=r(3210),n=r(4780);let i=a.forwardRef(({className:e,...t},r)=>(0,s.jsx)("div",{ref:r,className:(0,n.cn)("rounded-lg border border-gray-200 bg-white text-gray-950 shadow-sm",e),...t}));i.displayName="Card";let l=a.forwardRef(({className:e,...t},r)=>(0,s.jsx)("div",{ref:r,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",e),...t}));l.displayName="CardHeader";let d=a.forwardRef(({className:e,...t},r)=>(0,s.jsx)("h3",{ref:r,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",e),...t}));d.displayName="CardTitle";let o=a.forwardRef(({className:e,...t},r)=>(0,s.jsx)("p",{ref:r,className:(0,n.cn)("text-sm text-gray-500",e),...t}));o.displayName="CardDescription";let c=a.forwardRef(({className:e,...t},r)=>(0,s.jsx)("div",{ref:r,className:(0,n.cn)("p-6 pt-0",e),...t}));c.displayName="CardContent",a.forwardRef(({className:e,...t},r)=>(0,s.jsx)("div",{ref:r,className:(0,n.cn)("flex items-center p-6 pt-0",e),...t})).displayName="CardFooter"},9082:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(9377).A)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},9121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},9235:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(9377).A)("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]])},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9377:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});var s=r(3210),a={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let n=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();var i=(e,t)=>{let r=(0,s.forwardRef)(({color:r="currentColor",size:i=24,strokeWidth:l=2,absoluteStrokeWidth:d,children:o,...c},m)=>(0,s.createElement)("svg",{ref:m,...a,width:i,height:i,stroke:r,strokeWidth:d?24*Number(l)/Number(i):l,className:`lucide lucide-${n(e)}`,...c},[...t.map(([e,t])=>(0,s.createElement)(e,t)),...(Array.isArray(o)?o:[o])||[]]));return r.displayName=`${e}`,r}},9551:e=>{"use strict";e.exports=require("url")},9805:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>f});var s=r(687),a=r(3210),n=r(6391),i=r(3732),l=r(1523),d=r(2643),o=r(1907),c=r(8749),m=r(9235),u=r(1787),x=r(983),h=r(6073),p=r(4463),g=r(9082);function f(){let{tenantUser:e}=(0,i.h)(),{selectedTenant:t}=(0,l.K)(),[r,f]=(0,a.useState)([]),[y,v]=(0,a.useState)([]),[b,j]=(0,a.useState)([]),[N,w]=(0,a.useState)(!0),[k,_]=(0,a.useState)(null),[C,A]=(0,a.useState)(""),[E,M]=(0,a.useState)(!1),[P,T]=(0,a.useState)(!1),q=e?.role==="host_admin"||e?.role==="program_manager",R=async()=>{try{let{data:e,error:t}=await n.ND.from("tenants").select("*").order("name");if(t)throw t;f(e||[])}catch(e){console.error("Error loading tenants:",e)}},$=async e=>{try{w(!0);let{data:t,error:r}=await n.ND.from("tenant_users").select(`
          id,
          user_id,
          tenant_id,
          role,
          is_active,
          created_at
        `).eq("tenant_id",e).order("created_at",{ascending:!1});if(r)throw r;let s=await Promise.all((t||[]).map(async e=>{let{data:t}=await n.ND.from("auth.users").select("email").eq("id",e.user_id).single();return{...e,email:t?.email||"Unknown"}}));v(s)}catch(e){console.error("Error loading tenant users:",e)}finally{w(!1)}},B=async(e,t)=>{if(k)try{let{error:r}=await n.ND.from("tenant_users").insert({user_id:e,tenant_id:k,role:t,is_active:!0});if(r)throw r;M(!1),$(k)}catch(e){console.error("Error adding user to tenant:",e)}},S=async e=>{try{let{error:t}=await n.ND.from("tenant_users").update({is_active:!1}).eq("id",e);if(t)throw t;k&&$(k)}catch(e){console.error("Error removing user from tenant:",e)}},L=async(e,t)=>{try{let{error:r}=await n.ND.from("tenant_users").update({role:t}).eq("id",e);if(r)throw r;k&&$(k)}catch(e){console.error("Error updating user role:",e)}},U=async e=>{try{let{error:t}=await n.ND.from("tenants").insert({...e,status:"active",subscription_plan:"professional",max_users:25,max_projects:50,is_active:!0,tenant_level:1,settings:{},feature_flags:{},usage_quotas:{},rbac_settings:{}});if(t)throw t;T(!1),R()}catch(e){console.error("Error creating tenant:",e)}},D=r.filter(e=>e.name?.toLowerCase().includes(C.toLowerCase())||e.code?.toLowerCase().includes(C.toLowerCase())),z=e=>{switch(e){case"host_admin":return"bg-red-100 text-red-800";case"program_manager":return"bg-blue-100 text-blue-800";case"client_admin":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}};return q?(0,s.jsxs)("div",{className:"p-6 space-y-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Tenant Management"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Manage tenants and user assignments"})]}),(0,s.jsxs)(d.$,{onClick:()=>T(!0),children:[(0,s.jsx)(u.A,{className:"h-4 w-4 mr-2"}),"Create Tenant"]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,s.jsxs)(c.Zp,{children:[(0,s.jsxs)(c.aR,{children:[(0,s.jsxs)(c.ZB,{className:"flex items-center gap-2",children:[(0,s.jsx)(m.A,{className:"h-5 w-5"}),"Tenants (",D.length,")"]}),(0,s.jsx)(c.BT,{children:"Select a tenant to manage its users"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(x.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,s.jsx)("input",{type:"text",placeholder:"Search tenants...",value:C,onChange:e=>A(e.target.value),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),(0,s.jsx)(c.Wu,{children:(0,s.jsx)("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:D.map(e=>(0,s.jsx)("div",{className:`p-3 border rounded-lg cursor-pointer transition-colors ${k===e.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>_(e.id),children:(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-medium text-gray-900",children:e.name||"Unnamed Tenant"}),(0,s.jsxs)("p",{className:"text-sm text-gray-500",children:["Code: ",e.code||"No code"]}),(0,s.jsxs)("p",{className:"text-sm text-gray-500",children:["Type: ",e.tenant_type||"Unknown"]})]}),(0,s.jsx)("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${"active"===e.status?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:e.status})]})},e.id))})})]}),(0,s.jsxs)(c.Zp,{children:[(0,s.jsxs)(c.aR,{children:[(0,s.jsxs)(c.ZB,{className:"flex items-center gap-2",children:[(0,s.jsx)(h.A,{className:"h-5 w-5"}),"Tenant Users",k&&(0,s.jsxs)(d.$,{size:"sm",onClick:()=>M(!0),className:"ml-auto",children:[(0,s.jsx)(p.A,{className:"h-4 w-4 mr-2"}),"Add User"]})]}),(0,s.jsx)(c.BT,{children:k?`Users assigned to ${r.find(e=>e.id===k)?.name||"selected tenant"}`:"Select a tenant to view its users"})]}),(0,s.jsx)(c.Wu,{children:k?(0,s.jsx)("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:N?(0,s.jsx)("div",{className:"text-center py-4",children:"Loading users..."}):0===y.length?(0,s.jsx)("div",{className:"text-center py-4 text-gray-500",children:"No users assigned to this tenant"}):y.map(e=>(0,s.jsx)("div",{className:"p-3 border border-gray-200 rounded-lg",children:(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-medium text-gray-900",children:e.email}),(0,s.jsxs)("p",{className:"text-sm text-gray-500",children:["User ID: ",e.user_id.slice(0,8),"..."]}),(0,s.jsxs)("p",{className:"text-sm text-gray-500",children:["Added: ",new Date(e.created_at).toLocaleDateString()]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:z(e.role),children:e.role}),(0,s.jsxs)("select",{value:e.role,onChange:t=>L(e.id,t.target.value),className:"text-xs border border-gray-300 rounded px-2 py-1",children:[(0,s.jsx)("option",{value:"host_admin",children:"Host Admin"}),(0,s.jsx)("option",{value:"program_manager",children:"Program Manager"}),(0,s.jsx)("option",{value:"client_admin",children:"Client Admin"}),(0,s.jsx)("option",{value:"client_user",children:"Client User"})]}),(0,s.jsx)(d.$,{size:"sm",variant:"outline",onClick:()=>S(e.id),children:(0,s.jsx)(g.A,{className:"h-3 w-3"})})]})]})},e.id))}):(0,s.jsx)("div",{className:"text-center py-8 text-gray-500",children:"Select a tenant from the left to manage its users"})})]})]}),E&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[(0,s.jsx)("h3",{className:"text-lg font-medium mb-4",children:"Add User to Tenant"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select User"}),(0,s.jsxs)("select",{id:"user-select",className:"w-full border border-gray-300 rounded-md px-3 py-2",children:[(0,s.jsx)("option",{value:"",children:"Choose a user..."}),b.map(e=>(0,s.jsx)("option",{value:e.id,children:e.email},e.id))]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Role"}),(0,s.jsxs)("select",{id:"role-select",className:"w-full border border-gray-300 rounded-md px-3 py-2",children:[(0,s.jsx)("option",{value:"client_user",children:"Client User"}),(0,s.jsx)("option",{value:"client_admin",children:"Client Admin"}),(0,s.jsx)("option",{value:"program_manager",children:"Program Manager"}),(0,s.jsx)("option",{value:"host_admin",children:"Host Admin"})]})]})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-2 mt-6",children:[(0,s.jsx)(d.$,{variant:"outline",onClick:()=>M(!1),children:"Cancel"}),(0,s.jsx)(d.$,{onClick:()=>{let e=document.getElementById("user-select"),t=document.getElementById("role-select");e.value&&t.value&&B(e.value,t.value)},children:"Add User"})]})]})}),P&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[(0,s.jsx)("h3",{className:"text-lg font-medium mb-4",children:"Create New Tenant"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tenant Name"}),(0,s.jsx)(o.p,{id:"tenant-name",placeholder:"Enter tenant name"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tenant Code"}),(0,s.jsx)(o.p,{id:"tenant-code",placeholder:"Enter tenant code (e.g., ACME)"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tenant Type"}),(0,s.jsxs)("select",{id:"tenant-type",className:"w-full border border-gray-300 rounded-md px-3 py-2",children:[(0,s.jsx)("option",{value:"enterprise",children:"Enterprise"}),(0,s.jsx)("option",{value:"client",children:"Client"}),(0,s.jsx)("option",{value:"partner",children:"Partner"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contact Email"}),(0,s.jsx)(o.p,{id:"contact-email",type:"email",placeholder:"Enter contact email"})]})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-2 mt-6",children:[(0,s.jsx)(d.$,{variant:"outline",onClick:()=>T(!1),children:"Cancel"}),(0,s.jsx)(d.$,{onClick:()=>{let e=document.getElementById("tenant-name"),t=document.getElementById("tenant-code"),r=document.getElementById("tenant-type"),s=document.getElementById("contact-email");e.value&&t.value&&s.value&&U({name:e.value,code:t.value,tenant_type:r.value,contact_email:s.value})},children:"Create Tenant"})]})]})})]}):(0,s.jsx)("div",{className:"p-6",children:(0,s.jsx)(c.Zp,{children:(0,s.jsx)(c.Wu,{className:"pt-6",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(m.A,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,s.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"Access Denied"}),(0,s.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"You need admin privileges to access tenant management."})]})})})})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[197,69,897],()=>r(515));module.exports=s})();