"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[466],{6466:(e,t,a)=>{a.d(t,{AuthProvider:()=>l,As:()=>I});var n=a(5155),r=a(2115),o=a(2354);let i={MIGRATION_WORKBENCH:"migration-workbench",FILE_UPLOAD:"file-upload",DATA_VALIDATION:"data-validation",EMPLOYEE_DATA_PROCESSING:"employee-data-processing",PROJECT_MANAGEMENT:"project-management",WORK_REQUESTS:"work-requests",PROJECT_CHARTER:"project-charter",RISK_MANAGEMENT:"risk-management",RESOURCE_MANAGEMENT:"resource-management",REPORTING:"reporting",DASHBOARDS:"dashboards",ANALYTICS:"analytics",HISTORICAL_DATA:"historical-data",USER_MANAGEMENT:"user-management",ACCESS_CONTROL:"access-control",TENANT_MANAGEMENT:"tenant-management",SYSTEM_SETTINGS:"system-settings",AUDIT_LOGS:"audit-logs",BENEFITS_MANAGEMENT:"benefits-management",PAYROLL_PROCESSING:"payroll-processing",EMPLOYEE_RECORDS:"employee-records"},s={VIEW:"view",CREATE:"create",UPDATE:"update",DELETE:"delete",MANAGE:"manage",APPROVE:"approve",EXPORT:"export",IMPORT:"import"},E={TENANT:"tenant"},c={host_admin:{role:"host_admin",permissions:[{feature:i.USER_MANAGEMENT,permission:s.MANAGE},{feature:i.ACCESS_CONTROL,permission:s.MANAGE},{feature:i.TENANT_MANAGEMENT,permission:s.MANAGE},{feature:i.SYSTEM_SETTINGS,permission:s.MANAGE},{feature:i.AUDIT_LOGS,permission:s.VIEW},{feature:i.PROJECT_MANAGEMENT,permission:s.MANAGE},{feature:i.WORK_REQUESTS,permission:s.MANAGE},{feature:i.REPORTING,permission:s.MANAGE},{feature:i.MIGRATION_WORKBENCH,permission:s.MANAGE},{feature:i.BENEFITS_MANAGEMENT,permission:s.MANAGE}]},program_manager:{role:"program_manager",permissions:[{feature:i.PROJECT_MANAGEMENT,permission:s.MANAGE},{feature:i.WORK_REQUESTS,permission:s.MANAGE},{feature:i.PROJECT_CHARTER,permission:s.MANAGE},{feature:i.RISK_MANAGEMENT,permission:s.MANAGE},{feature:i.RESOURCE_MANAGEMENT,permission:s.MANAGE},{feature:i.REPORTING,permission:s.VIEW},{feature:i.DASHBOARDS,permission:s.VIEW},{feature:i.ANALYTICS,permission:s.VIEW},{feature:i.USER_MANAGEMENT,permission:s.VIEW},{feature:i.MIGRATION_WORKBENCH,permission:s.VIEW},{feature:i.DATA_VALIDATION,permission:s.VIEW}]},client_admin:{role:"client_admin",permissions:[{feature:i.USER_MANAGEMENT,permission:s.MANAGE},{feature:i.ACCESS_CONTROL,permission:s.VIEW},{feature:i.PROJECT_MANAGEMENT,permission:s.MANAGE},{feature:i.WORK_REQUESTS,permission:s.MANAGE},{feature:i.REPORTING,permission:s.VIEW},{feature:i.DASHBOARDS,permission:s.VIEW},{feature:i.BENEFITS_MANAGEMENT,permission:s.MANAGE},{feature:i.EMPLOYEE_RECORDS,permission:s.MANAGE},{feature:i.FILE_UPLOAD,permission:s.CREATE},{feature:i.DATA_VALIDATION,permission:s.VIEW},{feature:i.MIGRATION_WORKBENCH,permission:s.VIEW}]},client_user:{role:"client_user",permissions:[{feature:i.WORK_REQUESTS,permission:s.CREATE},{feature:i.WORK_REQUESTS,permission:s.VIEW},{feature:i.WORK_REQUESTS,permission:s.UPDATE},{feature:i.PROJECT_MANAGEMENT,permission:s.VIEW},{feature:i.REPORTING,permission:s.VIEW},{feature:i.DASHBOARDS,permission:s.VIEW},{feature:i.BENEFITS_MANAGEMENT,permission:s.VIEW},{feature:i.FILE_UPLOAD,permission:s.CREATE}]}};class A extends Error{constructor(e,t,a,n){super(e),this.feature=t,this.permission=a,this.userRole=n,this.name="ServiceAuthError"}}let d={host_admin:["*"],program_manager:["".concat(i.PROJECT_MANAGEMENT,":").concat(s.MANAGE),"".concat(i.WORK_REQUESTS,":").concat(s.MANAGE),"".concat(i.PROJECT_CHARTER,":").concat(s.MANAGE),"".concat(i.RISK_MANAGEMENT,":").concat(s.MANAGE),"".concat(i.RESOURCE_MANAGEMENT,":").concat(s.MANAGE),"".concat(i.REPORTING,":").concat(s.VIEW),"".concat(i.DASHBOARDS,":").concat(s.VIEW),"".concat(i.ANALYTICS,":").concat(s.VIEW),"".concat(i.USER_MANAGEMENT,":").concat(s.VIEW),"".concat(i.MIGRATION_WORKBENCH,":").concat(s.VIEW),"".concat(i.DATA_VALIDATION,":").concat(s.VIEW)],client_admin:["".concat(i.USER_MANAGEMENT,":").concat(s.MANAGE),"".concat(i.ACCESS_CONTROL,":").concat(s.VIEW),"".concat(i.PROJECT_MANAGEMENT,":").concat(s.MANAGE),"".concat(i.WORK_REQUESTS,":").concat(s.MANAGE),"".concat(i.REPORTING,":").concat(s.VIEW),"".concat(i.DASHBOARDS,":").concat(s.VIEW),"".concat(i.BENEFITS_MANAGEMENT,":").concat(s.MANAGE),"".concat(i.EMPLOYEE_RECORDS,":").concat(s.MANAGE),"".concat(i.FILE_UPLOAD,":").concat(s.CREATE),"".concat(i.DATA_VALIDATION,":").concat(s.VIEW),"".concat(i.MIGRATION_WORKBENCH,":").concat(s.VIEW)],client_user:["".concat(i.WORK_REQUESTS,":").concat(s.CREATE),"".concat(i.WORK_REQUESTS,":").concat(s.VIEW),"".concat(i.WORK_REQUESTS,":").concat(s.UPDATE),"".concat(i.PROJECT_MANAGEMENT,":").concat(s.VIEW),"".concat(i.REPORTING,":").concat(s.VIEW),"".concat(i.DASHBOARDS,":").concat(s.VIEW),"".concat(i.BENEFITS_MANAGEMENT,":").concat(s.VIEW),"".concat(i.FILE_UPLOAD,":").concat(s.CREATE)]};var u=a(9509);let _=(0,r.createContext)(void 0),S=u.env.NEXT_PUBLIC_SUPABASE_URL||"https://demo.supabase.co",N=u.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"demo-key",m=(0,o.UU)(S,N);function l(e){let{children:t}=e,[a,o]=(0,r.useState)(null),[i,s]=(0,r.useState)(null),[E,c]=(0,r.useState)(!0),[A,d]=(0,r.useState)(!1),[S,N]=(0,r.useState)({id:"54afbd1d-e72a-41e1-9d39-2c8a08a257ff",name:"Demo Company",slug:"demo-company",created_at:new Date().toISOString(),updated_at:new Date().toISOString()}),[l,I]=(0,r.useState)({id:"demo-tenant-user-id",tenant_id:"54afbd1d-e72a-41e1-9d39-2c8a08a257ff",user_id:"demo-user-id",role:"client_admin",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}),T=!!a||!!i,R=!u.env.NEXT_PUBLIC_SUPABASE_URL||"https://demo.supabase.co"===u.env.NEXT_PUBLIC_SUPABASE_URL,O=(null==a?void 0:a.id)||(null==l?void 0:l.user_id)||null,M=(null==S?void 0:S.id)||null,p=(null==l?void 0:l.role)||null,f=()=>{try{localStorage.setItem("etla-auth-context",JSON.stringify({userId:O,tenantId:M,userRole:p,isAuthenticated:T,isDemoMode:R}))}catch(e){console.warn("Failed to store auth context in localStorage:",e)}};(0,r.useEffect)(()=>{console.log("\uD83D\uDD10 AuthProvider: Initializing authentication state"),(async()=>{try{let{data:{session:e},error:t}=await m.auth.getSession();t?(console.error("❌ AuthProvider: Error getting session:",t),o({id:"demo-user-id",email:"demo@company.com",created_at:new Date().toISOString(),updated_at:new Date().toISOString(),app_metadata:{},user_metadata:{},aud:"authenticated",confirmation_sent_at:new Date().toISOString()}),I({id:"demo-tenant-user-id",tenant_id:"54afbd1d-e72a-41e1-9d39-2c8a08a257ff",user_id:"demo-user-id",role:"client_admin",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()})):e?(console.log("✅ AuthProvider: Found existing session"),s(e),o(e.user),I({id:"demo-tenant-user-id",tenant_id:"54afbd1d-e72a-41e1-9d39-2c8a08a257ff",user_id:e.user.id,role:"client_admin",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()})):(console.log("⚠️ AuthProvider: No existing session, using demo user"),o({id:"demo-user-id",email:"demo@company.com",created_at:new Date().toISOString(),updated_at:new Date().toISOString(),app_metadata:{},user_metadata:{},aud:"authenticated",confirmation_sent_at:new Date().toISOString()}),I({id:"demo-tenant-user-id",tenant_id:"54afbd1d-e72a-41e1-9d39-2c8a08a257ff",user_id:"demo-user-id",role:"client_admin",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()})),c(!1),d(!0),f(),console.log("✅ AuthProvider: Authentication state stabilized")}catch(e){console.error("❌ AuthProvider: Unexpected error during initialization:",e),o(null),s(null),I({id:"demo-tenant-user-id",tenant_id:"54afbd1d-e72a-41e1-9d39-2c8a08a257ff",user_id:"demo-user-id",role:"client_admin",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}),c(!1),d(!0),f()}})();let{data:{subscription:e}}=m.auth.onAuthStateChange(async(e,t)=>{console.log("\uD83D\uDD04 AuthProvider: Auth state changed:",e),t?(s(t),o(t.user),I({id:"demo-tenant-user-id",tenant_id:"54afbd1d-e72a-41e1-9d39-2c8a08a257ff",user_id:t.user.id,role:"client_admin",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()})):(console.log("⚠️ AuthProvider: User signed out, falling back to demo user"),o({id:"demo-user-id",email:"demo@company.com",created_at:new Date().toISOString(),updated_at:new Date().toISOString(),app_metadata:{},user_metadata:{},aud:"authenticated",confirmation_sent_at:new Date().toISOString()}),s(null),I({id:"demo-tenant-user-id",tenant_id:"54afbd1d-e72a-41e1-9d39-2c8a08a257ff",user_id:"demo-user-id",role:"client_admin",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()})),c(!1),d(!0),f()});return()=>{e.unsubscribe()}},[]);let g=async(e,t)=>{try{let{error:a}=await m.auth.signInWithPassword({email:e,password:t});return{error:a}}catch(e){return console.error("❌ AuthProvider: Sign in error:",e),{error:e}}},G=async(e,t)=>{try{let{error:a}=await m.auth.signUp({email:e,password:t});return{error:a}}catch(e){return console.error("❌ AuthProvider: Sign up error:",e),{error:e}}},D=async()=>{console.log("\uD83D\uDD10 AuthProvider: Signing out"),await m.auth.signOut(),o(null),s(null),I({id:"demo-tenant-user-id",tenant_id:"54afbd1d-e72a-41e1-9d39-2c8a08a257ff",user_id:"demo-user-id",role:"client_admin",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}),c(!1),d(!0),f()},h=async()=>{console.log("\uD83D\uDD04 AuthProvider: Refreshing tenant information")},P=async()=>{console.log("\uD83D\uDD04 AuthProvider: Refreshing session");try{let{data:{session:e},error:t}=await m.auth.refreshSession();t?console.error("❌ AuthProvider: Error refreshing session:",t):(s(e),(null==e?void 0:e.user)&&o(e.user))}catch(e){console.error("❌ AuthProvider: Unexpected error refreshing session:",e)}};return(0,n.jsx)(_.Provider,{value:{user:a,tenant:S,tenantUser:l,session:i,loading:E,signIn:g,signUp:G,signOut:D,refreshTenant:h,refreshSession:P,isStable:A,isAuthenticated:T,isDemoMode:R,currentUserId:O,currentTenantId:M,currentUserRole:p},children:t})}function I(){let e=(0,r.useContext)(_);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}}}]);