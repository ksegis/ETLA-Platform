"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2099],{2099:(e,t,a)=>{a.d(t,{Lr:()=>s,ND:()=>r});let r=(0,a(2354).UU)("https://your-project.supabase.co","your_anon_token_here"),s={createUser:async e=>{try{let{data:t,error:a}=await r.auth.admin.createUser({email:e.email,password:e.password,email_confirm:!0,user_metadata:{full_name:e.full_name,role:e.role,role_level:e.role_level}});if(a)return{success:!1,error:a.message};if(!t.user)return{success:!1,error:"Failed to create user account"};let{error:s}=await r.from("profiles").insert({id:t.user.id,email:e.email,full_name:e.full_name,phone:e.phone,department:e.department,job_title:e.job_title,role:e.role,role_level:e.role_level,tenant_id:e.tenant_id,is_active:!0,can_invite_users:e.can_invite_users,can_manage_sub_clients:e.can_manage_sub_clients,permission_scope:e.permission_scope,created_at:new Date().toISOString(),updated_at:new Date().toISOString()});if(s)return await r.auth.admin.deleteUser(t.user.id),{success:!1,error:"Profile creation failed: ".concat(s.message)};let{error:i}=await r.from("tenant_users").insert({tenant_id:e.tenant_id,user_id:t.user.id,role:e.role,role_level:e.role_level,can_invite_users:e.can_invite_users,can_manage_sub_clients:e.can_manage_sub_clients,permission_scope:e.permission_scope,is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()});if(i)return await r.auth.admin.deleteUser(t.user.id),await r.from("profiles").delete().eq("id",t.user.id),{success:!1,error:"Tenant assignment failed: ".concat(i.message)};try{await r.from("audit_logs").insert({user_id:t.user.id,tenant_id:e.tenant_id,action:"user_created",resource_type:"user",resource_id:t.user.id,details:{created_by:"admin_interface",role:e.role,role_level:e.role_level,email:e.email},ip_address:"127.0.0.1",user_agent:"Admin Interface",severity:"info",created_at:new Date().toISOString()})}catch(e){console.warn("Audit log creation failed:",e)}return{success:!0,data:t.user}}catch(e){return{success:!1,error:e.message||"Failed to create user"}}},inviteUsers:async e=>{try{let t=[];for(let a of e.emails){let{data:s,error:i}=await r.from("user_invitations").insert({email:a,role:e.role,role_level:e.role_level,tenant_id:e.tenant_id,message:e.message,expires_at:new Date(Date.now()+24*e.expires_in_days*36e5).toISOString(),created_at:new Date().toISOString()}).select().single();if(i){console.error("Failed to create invitation for ".concat(a,":"),i);continue}let{error:n}=await r.auth.admin.inviteUserByEmail(a,{redirectTo:"".concat(window.location.origin,"/accept-invitation?token=").concat(s.id),data:{role:e.role,role_level:e.role_level,tenant_id:e.tenant_id,invitation_id:s.id}});n?(console.error("Failed to send invitation email to ".concat(a,":"),n),await r.from("user_invitations").update({status:"failed"}).eq("id",s.id)):t.push(s)}return{success:!0,data:{sent:t.length,total:e.emails.length}}}catch(e){return{success:!1,error:e.message||"Failed to send invitations"}}},updateUser:async(e,t)=>{try{let{error:a}=await r.from("profiles").update({...t,updated_at:new Date().toISOString()}).eq("id",e);if(a)return{success:!1,error:a.message};return{success:!0}}catch(e){return{success:!1,error:e.message||"Failed to update user"}}},deactivateUser:async e=>{try{let{error:t}=await r.from("profiles").update({is_active:!1,updated_at:new Date().toISOString()}).eq("id",e);if(t)return{success:!1,error:t.message};return{success:!0}}catch(e){return{success:!1,error:e.message||"Failed to deactivate user"}}},activateUser:async e=>{try{let{error:t}=await r.from("profiles").update({is_active:!0,updated_at:new Date().toISOString()}).eq("id",e);if(t)return{success:!1,error:t.message};return{success:!0}}catch(e){return{success:!1,error:e.message||"Failed to activate user"}}},resetUserPassword:async(e,t)=>{try{if(t){let{error:a}=await r.auth.admin.updateUserById(e,{password:t});if(a)return{success:!1,error:a.message};return{success:!0}}{let{error:t}=await r.auth.resetPasswordForEmail(e,{redirectTo:"".concat(window.location.origin,"/reset-password")});if(t)return{success:!1,error:t.message};return{success:!0}}}catch(e){return{success:!1,error:e.message||"Failed to reset password"}}},previewUserCleanup:async e=>{try{let t=0,a=0,s=0;if(e.deleteInactiveUsers){let a=new Date(Date.now()-24*e.inactiveDays*36e5).toISOString(),{count:s}=await r.from("profiles").select("*",{count:"exact",head:!0}).lt("last_login",a).eq("is_active",!0);t=s||0}if(e.deleteUnconfirmedUsers){let t=new Date(Date.now()-24*e.unconfirmedDays*36e5).toISOString(),{count:s}=await r.from("auth.users").select("*",{count:"exact",head:!0}).is("email_confirmed_at",null).lt("created_at",t);a=s||0}if(e.deleteExpiredInvites){let{count:e}=await r.from("user_invitations").select("*",{count:"exact",head:!0}).lt("expires_at",new Date().toISOString()).neq("status","accepted");s=e||0}let i=t+a+s;return{success:!0,data:{inactiveUsers:t,unconfirmedUsers:a,expiredInvites:s,totalToDelete:i}}}catch(e){return{success:!1,error:e.message||"Failed to preview cleanup"}}},executeUserCleanup:async e=>{try{let t=0;if(e.deleteInactiveUsers){let a=new Date(Date.now()-24*e.inactiveDays*36e5).toISOString(),{data:s}=await r.from("profiles").select("id").lt("last_login",a).eq("is_active",!0);if(s){for(let e of s)await r.auth.admin.deleteUser(e.id),await r.from("profiles").delete().eq("id",e.id);t+=s.length}}if(e.deleteUnconfirmedUsers){let a=new Date(Date.now()-24*e.unconfirmedDays*36e5).toISOString(),{data:s}=await r.from("profiles").select("id").lt("created_at",a).eq("is_active",!0);s&&(await r.from("profiles").update({is_active:!1}).in("id",s.map(e=>e.id)),t+=s.length)}if(e.deleteExpiredInvites){let{count:e}=await r.from("user_invitations").delete().lt("expires_at",new Date().toISOString()).neq("status","accepted");t+=e||0}return{success:!0,data:{deletedCount:t}}}catch(e){return{success:!1,error:e.message||"Failed to execute cleanup"}}}};Object.assign(r,s)}}]);