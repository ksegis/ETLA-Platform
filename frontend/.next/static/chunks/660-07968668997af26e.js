"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[660],{7020:(e,t,a)=>{a.d(t,{AuthProvider:()=>d,As:()=>u});var n=a(5155),r=a(2115),i=a(2354),o=a(8513);class s extends Error{constructor(e,t,a,n){super(e),this.feature=t,this.permission=a,this.userRole=n,this.name="ServiceAuthError"}}let E={host_admin:["*"],program_manager:["".concat(o.Gv.PROJECT_MANAGEMENT,":").concat(o.Jj.MANAGE),"".concat(o.Gv.WORK_REQUESTS,":").concat(o.Jj.MANAGE),"".concat(o.Gv.PROJECT_CHARTER,":").concat(o.Jj.MANAGE),"".concat(o.Gv.RISK_MANAGEMENT,":").concat(o.Jj.MANAGE),"".concat(o.Gv.RESOURCE_MANAGEMENT,":").concat(o.Jj.MANAGE),"".concat(o.Gv.REPORTING,":").concat(o.Jj.VIEW),"".concat(o.Gv.DASHBOARDS,":").concat(o.Jj.VIEW),"".concat(o.Gv.ANALYTICS,":").concat(o.Jj.VIEW),"".concat(o.Gv.USER_MANAGEMENT,":").concat(o.Jj.VIEW),"".concat(o.Gv.MIGRATION_WORKBENCH,":").concat(o.Jj.VIEW),"".concat(o.Gv.DATA_VALIDATION,":").concat(o.Jj.VIEW)],client_admin:["".concat(o.Gv.USER_MANAGEMENT,":").concat(o.Jj.MANAGE),"".concat(o.Gv.ACCESS_CONTROL,":").concat(o.Jj.VIEW),"".concat(o.Gv.PROJECT_MANAGEMENT,":").concat(o.Jj.MANAGE),"".concat(o.Gv.WORK_REQUESTS,":").concat(o.Jj.MANAGE),"".concat(o.Gv.REPORTING,":").concat(o.Jj.VIEW),"".concat(o.Gv.DASHBOARDS,":").concat(o.Jj.VIEW),"".concat(o.Gv.BENEFITS_MANAGEMENT,":").concat(o.Jj.MANAGE),"".concat(o.Gv.EMPLOYEE_RECORDS,":").concat(o.Jj.MANAGE),"".concat(o.Gv.FILE_UPLOAD,":").concat(o.Jj.CREATE),"".concat(o.Gv.DATA_VALIDATION,":").concat(o.Jj.VIEW),"".concat(o.Gv.MIGRATION_WORKBENCH,":").concat(o.Jj.VIEW)],client_user:["".concat(o.Gv.WORK_REQUESTS,":").concat(o.Jj.CREATE),"".concat(o.Gv.WORK_REQUESTS,":").concat(o.Jj.VIEW),"".concat(o.Gv.WORK_REQUESTS,":").concat(o.Jj.UPDATE),"".concat(o.Gv.PROJECT_MANAGEMENT,":").concat(o.Jj.VIEW),"".concat(o.Gv.REPORTING,":").concat(o.Jj.VIEW),"".concat(o.Gv.DASHBOARDS,":").concat(o.Jj.VIEW),"".concat(o.Gv.BENEFITS_MANAGEMENT,":").concat(o.Jj.VIEW),"".concat(o.Gv.FILE_UPLOAD,":").concat(o.Jj.CREATE)]},A=(0,r.createContext)(void 0),c=(0,i.UU)("https://placeholder.supabase.co","placeholder_key");function d(e){let{children:t}=e,[a,i]=(0,r.useState)(null),[o,s]=(0,r.useState)(null),[E,d]=(0,r.useState)(!0),[u,_]=(0,r.useState)(!1),[S,N]=(0,r.useState)({id:"54afbd1d-e72a-41e1-9d39-2c8a08a257ff",name:"Demo Company",slug:"demo-company",created_at:new Date().toISOString(),updated_at:new Date().toISOString()}),[l,m]=(0,r.useState)({id:"demo-tenant-user-id",tenant_id:"54afbd1d-e72a-41e1-9d39-2c8a08a257ff",user_id:"demo-user-id",role:"client_admin",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}),T=!!a||!!o,R=(null==a?void 0:a.id)||(null==l?void 0:l.user_id)||null,O=(null==S?void 0:S.id)||null,G=(null==l?void 0:l.role)||null,I=()=>{try{localStorage.setItem("etla-auth-context",JSON.stringify({userId:R,tenantId:O,userRole:G,isAuthenticated:T,isDemoMode:!1}))}catch(e){console.warn("Failed to store auth context in localStorage:",e)}};(0,r.useEffect)(()=>{console.log("\uD83D\uDD10 AuthProvider: Initializing authentication state"),(async()=>{try{let{data:{session:e},error:t}=await c.auth.getSession();t?(console.error("❌ AuthProvider: Error getting session:",t),i({id:"demo-user-id",email:"demo@company.com",created_at:new Date().toISOString(),updated_at:new Date().toISOString(),app_metadata:{},user_metadata:{},aud:"authenticated",confirmation_sent_at:new Date().toISOString()}),m({id:"demo-tenant-user-id",tenant_id:"54afbd1d-e72a-41e1-9d39-2c8a08a257ff",user_id:"demo-user-id",role:"client_admin",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()})):e?(console.log("✅ AuthProvider: Found existing session"),s(e),i(e.user),m({id:"demo-tenant-user-id",tenant_id:"54afbd1d-e72a-41e1-9d39-2c8a08a257ff",user_id:e.user.id,role:"client_admin",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()})):(console.log("⚠️ AuthProvider: No existing session, using demo user"),i({id:"demo-user-id",email:"demo@company.com",created_at:new Date().toISOString(),updated_at:new Date().toISOString(),app_metadata:{},user_metadata:{},aud:"authenticated",confirmation_sent_at:new Date().toISOString()}),m({id:"demo-tenant-user-id",tenant_id:"54afbd1d-e72a-41e1-9d39-2c8a08a257ff",user_id:"demo-user-id",role:"client_admin",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()})),d(!1),_(!0),I(),console.log("✅ AuthProvider: Authentication state stabilized")}catch(e){console.error("❌ AuthProvider: Unexpected error during initialization:",e),i(null),s(null),m({id:"demo-tenant-user-id",tenant_id:"54afbd1d-e72a-41e1-9d39-2c8a08a257ff",user_id:"demo-user-id",role:"client_admin",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}),d(!1),_(!0),I()}})();let{data:{subscription:e}}=c.auth.onAuthStateChange(async(e,t)=>{console.log("\uD83D\uDD04 AuthProvider: Auth state changed:",e),t?(s(t),i(t.user),m({id:"demo-tenant-user-id",tenant_id:"54afbd1d-e72a-41e1-9d39-2c8a08a257ff",user_id:t.user.id,role:"client_admin",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()})):(console.log("⚠️ AuthProvider: User signed out, falling back to demo user"),i({id:"demo-user-id",email:"demo@company.com",created_at:new Date().toISOString(),updated_at:new Date().toISOString(),app_metadata:{},user_metadata:{},aud:"authenticated",confirmation_sent_at:new Date().toISOString()}),s(null),m({id:"demo-tenant-user-id",tenant_id:"54afbd1d-e72a-41e1-9d39-2c8a08a257ff",user_id:"demo-user-id",role:"client_admin",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()})),d(!1),_(!0),I()});return()=>{e.unsubscribe()}},[]);let M=async(e,t)=>{try{let{error:a}=await c.auth.signInWithPassword({email:e,password:t});return{error:a}}catch(e){return console.error("❌ AuthProvider: Sign in error:",e),{error:e}}},p=async(e,t)=>{try{let{error:a}=await c.auth.signUp({email:e,password:t});return{error:a}}catch(e){return console.error("❌ AuthProvider: Sign up error:",e),{error:e}}},f=async()=>{console.log("\uD83D\uDD10 AuthProvider: Signing out"),await c.auth.signOut(),i(null),s(null),m({id:"demo-tenant-user-id",tenant_id:"54afbd1d-e72a-41e1-9d39-2c8a08a257ff",user_id:"demo-user-id",role:"client_admin",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}),d(!1),_(!0),I()},g=async()=>{console.log("\uD83D\uDD04 AuthProvider: Refreshing tenant information")},v=async()=>{console.log("\uD83D\uDD04 AuthProvider: Refreshing session");try{let{data:{session:e},error:t}=await c.auth.refreshSession();t?console.error("❌ AuthProvider: Error refreshing session:",t):(s(e),(null==e?void 0:e.user)&&i(e.user))}catch(e){console.error("❌ AuthProvider: Unexpected error refreshing session:",e)}};return(0,n.jsx)(A.Provider,{value:{user:a,tenant:S,tenantUser:l,session:o,loading:E,signIn:M,signUp:p,signOut:f,refreshTenant:g,refreshSession:v,isStable:u,isAuthenticated:T,isDemoMode:!1,currentUserId:R,currentTenantId:O,currentUserRole:G},children:t})}function u(){let e=(0,r.useContext)(A);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},8513:(e,t,a)=>{a.d(t,{Gv:()=>i,Jj:()=>o,Sk:()=>A}),a(5155);var n=a(7020),r=a(2115);let i={MIGRATION_WORKBENCH:"migration-workbench",FILE_UPLOAD:"file-upload",DATA_VALIDATION:"data-validation",EMPLOYEE_DATA_PROCESSING:"employee-data-processing",PROJECT_MANAGEMENT:"project-management",WORK_REQUESTS:"work-requests",PROJECT_CHARTER:"project-charter",RISK_MANAGEMENT:"risk-management",RESOURCE_MANAGEMENT:"resource-management",REPORTING:"reporting",DASHBOARDS:"dashboards",ANALYTICS:"analytics",HISTORICAL_DATA:"historical-data",USER_MANAGEMENT:"user-management",ACCESS_CONTROL:"access-control",TENANT_MANAGEMENT:"tenant-management",SYSTEM_SETTINGS:"system-settings",AUDIT_LOGS:"audit-logs",BENEFITS_MANAGEMENT:"benefits-management",PAYROLL_PROCESSING:"payroll-processing",EMPLOYEE_RECORDS:"employee-records"},o={VIEW:"view",CREATE:"create",UPDATE:"update",DELETE:"delete",MANAGE:"manage",APPROVE:"approve",EXPORT:"export",IMPORT:"import"},s={TENANT:"tenant"},E={host_admin:{role:"host_admin",permissions:[{feature:i.USER_MANAGEMENT,permission:o.MANAGE},{feature:i.ACCESS_CONTROL,permission:o.MANAGE},{feature:i.TENANT_MANAGEMENT,permission:o.MANAGE},{feature:i.SYSTEM_SETTINGS,permission:o.MANAGE},{feature:i.AUDIT_LOGS,permission:o.VIEW},{feature:i.PROJECT_MANAGEMENT,permission:o.MANAGE},{feature:i.WORK_REQUESTS,permission:o.MANAGE},{feature:i.REPORTING,permission:o.MANAGE},{feature:i.MIGRATION_WORKBENCH,permission:o.MANAGE},{feature:i.BENEFITS_MANAGEMENT,permission:o.MANAGE}]},program_manager:{role:"program_manager",permissions:[{feature:i.PROJECT_MANAGEMENT,permission:o.MANAGE},{feature:i.WORK_REQUESTS,permission:o.MANAGE},{feature:i.PROJECT_CHARTER,permission:o.MANAGE},{feature:i.RISK_MANAGEMENT,permission:o.MANAGE},{feature:i.RESOURCE_MANAGEMENT,permission:o.MANAGE},{feature:i.REPORTING,permission:o.VIEW},{feature:i.DASHBOARDS,permission:o.VIEW},{feature:i.ANALYTICS,permission:o.VIEW},{feature:i.USER_MANAGEMENT,permission:o.VIEW},{feature:i.MIGRATION_WORKBENCH,permission:o.VIEW},{feature:i.DATA_VALIDATION,permission:o.VIEW}]},client_admin:{role:"client_admin",permissions:[{feature:i.USER_MANAGEMENT,permission:o.MANAGE},{feature:i.ACCESS_CONTROL,permission:o.VIEW},{feature:i.PROJECT_MANAGEMENT,permission:o.MANAGE},{feature:i.WORK_REQUESTS,permission:o.MANAGE},{feature:i.REPORTING,permission:o.VIEW},{feature:i.DASHBOARDS,permission:o.VIEW},{feature:i.BENEFITS_MANAGEMENT,permission:o.MANAGE},{feature:i.EMPLOYEE_RECORDS,permission:o.MANAGE},{feature:i.FILE_UPLOAD,permission:o.CREATE},{feature:i.DATA_VALIDATION,permission:o.VIEW},{feature:i.MIGRATION_WORKBENCH,permission:o.VIEW}]},client_user:{role:"client_user",permissions:[{feature:i.WORK_REQUESTS,permission:o.CREATE},{feature:i.WORK_REQUESTS,permission:o.VIEW},{feature:i.WORK_REQUESTS,permission:o.UPDATE},{feature:i.PROJECT_MANAGEMENT,permission:o.VIEW},{feature:i.REPORTING,permission:o.VIEW},{feature:i.DASHBOARDS,permission:o.VIEW},{feature:i.BENEFITS_MANAGEMENT,permission:o.VIEW},{feature:i.FILE_UPLOAD,permission:o.CREATE}]}};function A(){let{user:e,tenantUser:t,isAuthenticated:a,isDemoMode:A}=(0,n.As)(),[c,d]=(0,r.useState)([]),[u,_]=(0,r.useState)(!0);(0,r.useEffect)(()=>{if(!a||!t){d([]),_(!1);return}let e=E[t.role];e?d(e.permissions):d(E.client_user.permissions),_(!1)},[a,t]);let S=function(e,n){return arguments.length>2&&void 0!==arguments[2]?arguments[2]:s.TENANT,!!A||!!a&&!!t&&("host_admin"===t.role||c.some(t=>t.feature===e&&t.permission===n))},N=e=>!!A||!!a&&!!t&&("host_admin"===t.role||c.some(t=>t.feature===e)),l=e=>S(e,o.CREATE)||S(e,o.MANAGE),m=e=>S(e,o.UPDATE)||S(e,o.MANAGE),T=e=>S(e,o.DELETE)||S(e,o.MANAGE),R=e=>S(e,o.VIEW)||S(e,o.MANAGE)||l(e)||m(e),O=e=>S(e,o.MANAGE),G=e=>S(e,o.APPROVE)||S(e,o.MANAGE),I=e=>S(e,o.EXPORT)||S(e,o.MANAGE),M=()=>!!a&&!!t&&["host_admin","client_admin"].includes(t.role),p=()=>!!a&&!!t&&"host_admin"===t.role,f=()=>S(i.USER_MANAGEMENT,o.MANAGE),g=()=>N(i.ACCESS_CONTROL)||N(i.USER_MANAGEMENT)||N(i.SYSTEM_SETTINGS);return{hasPermission:S,canAccessFeature:N,getPermissionLevel:e=>A?[o.MANAGE]:a&&t?"host_admin"===t.role?[o.MANAGE]:c.filter(t=>t.feature===e).map(e=>e.permission):[],canCreate:l,canUpdate:m,canDelete:T,canView:R,canManage:O,canApprove:G,canExport:I,canImport:e=>S(e,o.IMPORT)||S(e,o.MANAGE),getAccessibleFeatures:()=>A?Object.values(i):a&&t?"host_admin"===t.role?Object.values(i):Array.from(new Set(c.map(e=>e.feature))):[],getUserPermissions:()=>({workRequests:{view:R(i.WORK_REQUESTS),create:l(i.WORK_REQUESTS),update:m(i.WORK_REQUESTS),approve:G(i.WORK_REQUESTS)},projects:{view:R(i.PROJECT_MANAGEMENT),create:l(i.PROJECT_MANAGEMENT),update:m(i.PROJECT_MANAGEMENT),delete:T(i.PROJECT_MANAGEMENT)},risks:{view:R(i.RISK_MANAGEMENT),manage:O(i.RISK_MANAGEMENT)},users:{view:R(i.USER_MANAGEMENT),manage:f()},reports:{view:R(i.REPORTING),export:I(i.REPORTING)},admin:{access:g(),isAdmin:M(),isHostAdmin:p()}}),isAdmin:M,isHostAdmin:p,canManageUsers:f,canAccessAdmin:g,userPermissions:c,isLoading:u,isDemoMode:A,isAuthenticated:a,currentRole:null==t?void 0:t.role,currentUserId:null==e?void 0:e.id,currentTenantId:null==t?void 0:t.tenant_id}}}}]);