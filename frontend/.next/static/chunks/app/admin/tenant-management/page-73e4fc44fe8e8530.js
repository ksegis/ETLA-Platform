(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4957],{403:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(7140).A)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]])},2539:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(7140).A)("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]])},2543:(e,t,a)=>{Promise.resolve().then(a.bind(a,4128))},3465:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(7140).A)("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]])},3715:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(7140).A)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},3741:(e,t,a)=>{"use strict";a.d(t,{$:()=>l});var s=a(5155),r=a(2115),n=a(9434);let l=r.forwardRef((e,t)=>{let{className:a,variant:r="default",size:l="default",...i}=e;return(0,s.jsx)("button",{className:(0,n.cn)("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-white transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{"bg-blue-600 text-white hover:bg-blue-700":"default"===r,"bg-red-600 text-white hover:bg-red-700":"destructive"===r,"border border-gray-300 bg-white hover:bg-gray-50":"outline"===r,"bg-gray-100 text-gray-900 hover:bg-gray-200":"secondary"===r,"hover:bg-gray-100":"ghost"===r,"text-blue-600 underline-offset-4 hover:underline":"link"===r},{"h-10 px-4 py-2":"default"===l,"h-9 rounded-md px-3":"sm"===l,"h-11 rounded-md px-8":"lg"===l,"h-10 w-10":"icon"===l},a),ref:t,...i})});l.displayName="Button"},3915:(e,t,a)=>{"use strict";a.d(t,{p:()=>l});var s=a(5155),r=a(2115),n=a(9434);let l=r.forwardRef((e,t)=>{let{className:a,type:r,...l}=e;return(0,s.jsx)("input",{type:r,className:(0,n.cn)("flex h-10 w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm ring-offset-white file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-gray-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),ref:t,...l})});l.displayName="Input"},4128:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>y});var s=a(5155),r=a(2115),n=a(2099),l=a(7020),i=a(7737),d=a(3741),c=a(3915),o=a(7703),u=a(2539),m=a(3715),x=a(7159),h=a(403),f=a(3465),g=a(6836);function y(){var e;let{tenantUser:t}=(0,l.h)(),{selectedTenant:a}=(0,i.Ku)(),[y,p]=(0,r.useState)([]),[v,j]=(0,r.useState)([]),[b,N]=(0,r.useState)([]),[w,_]=(0,r.useState)(!0),[k,C]=(0,r.useState)(null),[A,E]=(0,r.useState)(""),[M,T]=(0,r.useState)(!1),[S,D]=(0,r.useState)(!1),B=(null==t?void 0:t.role)==="host_admin"||(null==t?void 0:t.role)==="program_manager";(0,r.useEffect)(()=>{B&&(U(),I())},[B]),(0,r.useEffect)(()=>{k&&R(k)},[k]);let U=async()=>{try{let{data:e,error:t}=await n.ND.from("tenants").select("*").order("name");if(t)throw t;p(e||[])}catch(e){console.error("Error loading tenants:",e)}},I=async()=>{try{let{data:e,error:t}=await n.ND.from("auth.users").select("id, email, created_at").order("email");if(t)throw t;N(e||[])}catch(e){console.error("Error loading users:",e)}},R=async e=>{try{_(!0);let{data:t,error:a}=await n.ND.from("tenant_users").select("\n          id,\n          user_id,\n          tenant_id,\n          role,\n          is_active,\n          created_at\n        ").eq("tenant_id",e).order("created_at",{ascending:!1});if(a)throw a;let s=await Promise.all((t||[]).map(async e=>{let{data:t}=await n.ND.from("auth.users").select("email").eq("id",e.user_id).single();return{...e,email:(null==t?void 0:t.email)||"Unknown"}}));j(s)}catch(e){console.error("Error loading tenant users:",e)}finally{_(!1)}},q=async(e,t)=>{if(k)try{let{error:a}=await n.ND.from("tenant_users").insert({user_id:e,tenant_id:k,role:t,is_active:!0});if(a)throw a;T(!1),R(k)}catch(e){console.error("Error adding user to tenant:",e)}},P=async e=>{try{let{error:t}=await n.ND.from("tenant_users").update({is_active:!1}).eq("id",e);if(t)throw t;k&&R(k)}catch(e){console.error("Error removing user from tenant:",e)}},$=async(e,t)=>{try{let{error:a}=await n.ND.from("tenant_users").update({role:t}).eq("id",e);if(a)throw a;k&&R(k)}catch(e){console.error("Error updating user role:",e)}},z=async e=>{try{let{error:t}=await n.ND.from("tenants").insert({...e,status:"active",subscription_plan:"professional",max_users:25,max_projects:50,is_active:!0,tenant_level:1,settings:{},feature_flags:{},usage_quotas:{},rbac_settings:{}});if(t)throw t;D(!1),U()}catch(e){console.error("Error creating tenant:",e)}},Z=y.filter(e=>{var t,a;return(null==(t=e.name)?void 0:t.toLowerCase().includes(A.toLowerCase()))||(null==(a=e.code)?void 0:a.toLowerCase().includes(A.toLowerCase()))}),H=e=>{switch(e){case"host_admin":return"bg-red-100 text-red-800";case"program_manager":return"bg-blue-100 text-blue-800";case"client_admin":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}};return B?(0,s.jsxs)("div",{className:"p-6 space-y-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Tenant Management"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Manage tenants and user assignments"})]}),(0,s.jsxs)(d.$,{onClick:()=>D(!0),children:[(0,s.jsx)(m.A,{className:"h-4 w-4 mr-2"}),"Create Tenant"]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,s.jsxs)(o.Zp,{children:[(0,s.jsxs)(o.aR,{children:[(0,s.jsxs)(o.ZB,{className:"flex items-center gap-2",children:[(0,s.jsx)(u.A,{className:"h-5 w-5"}),"Tenants (",Z.length,")"]}),(0,s.jsx)(o.BT,{children:"Select a tenant to manage its users"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(x.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,s.jsx)("input",{type:"text",placeholder:"Search tenants...",value:A,onChange:e=>E(e.target.value),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),(0,s.jsx)(o.Wu,{children:(0,s.jsx)("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:Z.map(e=>(0,s.jsx)("div",{className:"p-3 border rounded-lg cursor-pointer transition-colors ".concat(k===e.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),onClick:()=>C(e.id),children:(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-medium text-gray-900",children:e.name||"Unnamed Tenant"}),(0,s.jsxs)("p",{className:"text-sm text-gray-500",children:["Code: ",e.code||"No code"]}),(0,s.jsxs)("p",{className:"text-sm text-gray-500",children:["Type: ",e.tenant_type||"Unknown"]})]}),(0,s.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat("active"===e.status?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:e.status})]})},e.id))})})]}),(0,s.jsxs)(o.Zp,{children:[(0,s.jsxs)(o.aR,{children:[(0,s.jsxs)(o.ZB,{className:"flex items-center gap-2",children:[(0,s.jsx)(h.A,{className:"h-5 w-5"}),"Tenant Users",k&&(0,s.jsxs)(d.$,{size:"sm",onClick:()=>T(!0),className:"ml-auto",children:[(0,s.jsx)(f.A,{className:"h-4 w-4 mr-2"}),"Add User"]})]}),(0,s.jsx)(o.BT,{children:k?"Users assigned to ".concat((null==(e=y.find(e=>e.id===k))?void 0:e.name)||"selected tenant"):"Select a tenant to view its users"})]}),(0,s.jsx)(o.Wu,{children:k?(0,s.jsx)("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:w?(0,s.jsx)("div",{className:"text-center py-4",children:"Loading users..."}):0===v.length?(0,s.jsx)("div",{className:"text-center py-4 text-gray-500",children:"No users assigned to this tenant"}):v.map(e=>(0,s.jsx)("div",{className:"p-3 border border-gray-200 rounded-lg",children:(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-medium text-gray-900",children:e.email}),(0,s.jsxs)("p",{className:"text-sm text-gray-500",children:["User ID: ",e.user_id.slice(0,8),"..."]}),(0,s.jsxs)("p",{className:"text-sm text-gray-500",children:["Added: ",new Date(e.created_at).toLocaleDateString()]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:H(e.role),children:e.role}),(0,s.jsxs)("select",{value:e.role,onChange:t=>$(e.id,t.target.value),className:"text-xs border border-gray-300 rounded px-2 py-1",children:[(0,s.jsx)("option",{value:"host_admin",children:"Host Admin"}),(0,s.jsx)("option",{value:"program_manager",children:"Program Manager"}),(0,s.jsx)("option",{value:"client_admin",children:"Client Admin"}),(0,s.jsx)("option",{value:"client_user",children:"Client User"})]}),(0,s.jsx)(d.$,{size:"sm",variant:"outline",onClick:()=>P(e.id),children:(0,s.jsx)(g.A,{className:"h-3 w-3"})})]})]})},e.id))}):(0,s.jsx)("div",{className:"text-center py-8 text-gray-500",children:"Select a tenant from the left to manage its users"})})]})]}),M&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[(0,s.jsx)("h3",{className:"text-lg font-medium mb-4",children:"Add User to Tenant"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select User"}),(0,s.jsxs)("select",{id:"user-select",className:"w-full border border-gray-300 rounded-md px-3 py-2",children:[(0,s.jsx)("option",{value:"",children:"Choose a user..."}),b.map(e=>(0,s.jsx)("option",{value:e.id,children:e.email},e.id))]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Role"}),(0,s.jsxs)("select",{id:"role-select",className:"w-full border border-gray-300 rounded-md px-3 py-2",children:[(0,s.jsx)("option",{value:"client_user",children:"Client User"}),(0,s.jsx)("option",{value:"client_admin",children:"Client Admin"}),(0,s.jsx)("option",{value:"program_manager",children:"Program Manager"}),(0,s.jsx)("option",{value:"host_admin",children:"Host Admin"})]})]})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-2 mt-6",children:[(0,s.jsx)(d.$,{variant:"outline",onClick:()=>T(!1),children:"Cancel"}),(0,s.jsx)(d.$,{onClick:()=>{let e=document.getElementById("user-select"),t=document.getElementById("role-select");e.value&&t.value&&q(e.value,t.value)},children:"Add User"})]})]})}),S&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[(0,s.jsx)("h3",{className:"text-lg font-medium mb-4",children:"Create New Tenant"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tenant Name"}),(0,s.jsx)(c.p,{id:"tenant-name",placeholder:"Enter tenant name"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tenant Code"}),(0,s.jsx)(c.p,{id:"tenant-code",placeholder:"Enter tenant code (e.g., ACME)"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tenant Type"}),(0,s.jsxs)("select",{id:"tenant-type",className:"w-full border border-gray-300 rounded-md px-3 py-2",children:[(0,s.jsx)("option",{value:"enterprise",children:"Enterprise"}),(0,s.jsx)("option",{value:"client",children:"Client"}),(0,s.jsx)("option",{value:"partner",children:"Partner"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contact Email"}),(0,s.jsx)(c.p,{id:"contact-email",type:"email",placeholder:"Enter contact email"})]})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-2 mt-6",children:[(0,s.jsx)(d.$,{variant:"outline",onClick:()=>D(!1),children:"Cancel"}),(0,s.jsx)(d.$,{onClick:()=>{let e=document.getElementById("tenant-name"),t=document.getElementById("tenant-code"),a=document.getElementById("tenant-type"),s=document.getElementById("contact-email");e.value&&t.value&&s.value&&z({name:e.value,code:t.value,tenant_type:a.value,contact_email:s.value})},children:"Create Tenant"})]})]})})]}):(0,s.jsx)("div",{className:"p-6",children:(0,s.jsx)(o.Zp,{children:(0,s.jsx)(o.Wu,{className:"pt-6",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(u.A,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,s.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"Access Denied"}),(0,s.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"You need admin privileges to access tenant management."})]})})})})}},6836:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(7140).A)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},7159:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(7140).A)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},7703:(e,t,a)=>{"use strict";a.d(t,{BT:()=>c,Wu:()=>o,ZB:()=>d,Zp:()=>l,aR:()=>i});var s=a(5155),r=a(2115),n=a(9434);let l=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("rounded-lg border border-gray-200 bg-white text-gray-950 shadow-sm",a),...r})});l.displayName="Card";let i=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",a),...r})});i.displayName="CardHeader";let d=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("h3",{ref:t,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",a),...r})});d.displayName="CardTitle";let c=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("p",{ref:t,className:(0,n.cn)("text-sm text-gray-500",a),...r})});c.displayName="CardDescription";let o=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",a),...r})});o.displayName="CardContent",r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",a),...r})}).displayName="CardFooter"},7737:(e,t,a)=>{"use strict";a.d(t,{Ku:()=>c,TenantProvider:()=>d,un:()=>u,wz:()=>o});var s=a(5155),r=a(2115),n=a(2099),l=a(7020);let i=(0,r.createContext)(void 0);function d(e){let{children:t}=e,{user:a,tenantUser:d,isAuthenticated:c,isDemoMode:o}=(0,l.h)(),[u,m]=(0,r.useState)(null),[x,h]=(0,r.useState)([]),[f,g]=(0,r.useState)(!0),y={id:"99883779-9517-4ca9-a3f8-7fdc59051f0e",name:"Demo Company",domain:"demo.company.com",status:"active",subscription_plan:"professional",subscription_start_date:new Date().toISOString(),max_users:25,current_users:5,settings:{},tenant_id:"99883779-9517-4ca9-a3f8-7fdc59051f0e",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},p=async()=>{if(o){h([y]),m(y),g(!1);return}if(!c||!a){h([]),m(null),g(!1);return}try{if((null==d?void 0:d.role)==="host_admin"){let{data:e,error:t}=await n.ND.from("tenants").select("*").order("name");if(t)throw t;h(e||[]);let a=(null==e?void 0:e[0])||null;m(a)}else{let{data:e,error:t}=await n.ND.from("tenant_users").select("tenant_id").eq("user_id",a.id).eq("is_active",!0);if(t)throw t;if(e&&e.length>0){let t=e.map(e=>e.tenant_id),{data:a,error:s}=await n.ND.from("tenants").select("*").in("id",t).order("name");if(s)throw s;h(a||[]);let r=(null==a?void 0:a.find(e=>e.id===(null==d?void 0:d.tenant_id)))||(null==a?void 0:a[0])||null;m(r)}else h([]),m(null)}}catch(e){console.error("Error loading tenants:",e),h([]),m(null)}finally{g(!1)}};return(0,r.useEffect)(()=>{p()},[c,a,d,o]),(0,s.jsx)(i.Provider,{value:{selectedTenant:u,setSelectedTenant:m,currentTenant:u,availableTenants:x,isLoading:f,loadAvailableTenants:p,canSelectTenant:()=>!o&&((null==d?void 0:d.role)==="host_admin"||(null==d?void 0:d.role)==="program_manager"),getAllAccessibleTenantIds:()=>o?[y.id]:x.map(e=>e.id),isMultiTenant:()=>x.length>1,isDemoMode:o},children:t})}function c(){let e=(0,r.useContext)(i);if(void 0===e)throw Error("useTenant must be used within a TenantProvider");return e}function o(){let{getAllAccessibleTenantIds:e}=c();return e()}function u(){let{isMultiTenant:e,selectedTenant:t,availableTenants:a}=c();return{isMultiTenant:e(),selectedTenant:t,availableTenants:a}}},9434:(e,t,a)=>{"use strict";a.d(t,{cn:()=>n});var s=a(2596),r=a(9688);function n(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,r.QP)((0,s.$)(t))}}},e=>{var t=t=>e(e.s=t);e.O(0,[7590,2354,2099,4660,8441,1684,7358],()=>t(2543)),_N_E=e.O()}]);