(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2415],{3741:(e,s,t)=>{"use strict";t.d(s,{$:()=>a});var l=t(5155),r=t(2115),n=t(9434);let a=r.forwardRef((e,s)=>{let{className:t,variant:r="default",size:a="default",...i}=e;return(0,l.jsx)("button",{className:(0,n.cn)("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-white transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{"bg-blue-600 text-white hover:bg-blue-700":"default"===r,"bg-red-600 text-white hover:bg-red-700":"destructive"===r,"border border-gray-300 bg-white hover:bg-gray-50":"outline"===r,"bg-gray-100 text-gray-900 hover:bg-gray-200":"secondary"===r,"hover:bg-gray-100":"ghost"===r,"text-blue-600 underline-offset-4 hover:underline":"link"===r},{"h-10 px-4 py-2":"default"===a,"h-9 rounded-md px-3":"sm"===a,"h-11 rounded-md px-8":"lg"===a,"h-10 w-10":"icon"===a},t),ref:s,...i})});a.displayName="Button"},3915:(e,s,t)=>{"use strict";t.d(s,{p:()=>a});var l=t(5155),r=t(2115),n=t(9434);let a=r.forwardRef((e,s)=>{let{className:t,type:r,...a}=e;return(0,l.jsx)("input",{type:r,className:(0,n.cn)("flex h-10 w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm ring-offset-white file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-gray-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:s,...a})});a.displayName="Input"},5851:(e,s,t)=>{Promise.resolve().then(t.bind(t,7517))},7517:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>y});var l=t(5155),r=t(2115),n=t(1073),a=t(8156),i=t(2550),o=t(3878),d=t(3715),c=t(7159),u=t(9076),x=t(7808),m=t(6836),g=t(3741),h=t(3915),b=t(7703),p=t(858),f=t(2099),j=t(7020),v=t(7737);let N={draft:{icon:n.A,color:"text-gray-600",bg:"bg-gray-100",label:"Draft"},submitted:{icon:n.A,color:"text-blue-600",bg:"bg-blue-100",label:"Submitted"},under_review:{icon:a.A,color:"text-yellow-600",bg:"bg-yellow-100",label:"Under Review"},approved:{icon:i.A,color:"text-green-600",bg:"bg-green-100",label:"Approved"},declined:{icon:o.A,color:"text-red-600",bg:"bg-red-100",label:"Declined"},in_progress:{icon:n.A,color:"text-indigo-600",bg:"bg-indigo-100",label:"In Progress"},completed:{icon:i.A,color:"text-green-600",bg:"bg-green-100",label:"Completed"},cancelled:{icon:o.A,color:"text-gray-600",bg:"bg-gray-100",label:"Cancelled"}},w={low:{color:"text-gray-600",bg:"bg-gray-100",label:"Low"},medium:{color:"text-yellow-600",bg:"bg-yellow-100",label:"Medium"},high:{color:"text-orange-600",bg:"bg-orange-100",label:"High"},critical:{color:"text-red-600",bg:"bg-red-100",label:"Critical"}};function y(){let[e,s]=(0,r.useState)([]),[t,o]=(0,r.useState)([]),[y,_]=(0,r.useState)(!0),[A,C]=(0,r.useState)(null),[D,k]=(0,r.useState)(""),[S,q]=(0,r.useState)(""),[E,L]=(0,r.useState)(""),[R,T]=(0,r.useState)({total:0,submitted:0,under_review:0,approved:0,in_progress:0,completed:0}),{user:W}=(0,j.h)(),{selectedTenant:B}=(0,v.K)(),I=async()=>{if(!(null==B?void 0:B.id)){console.log("No tenant selected, skipping load"),_(!1);return}try{_(!0),C(null),console.log("Loading work requests for tenant:",B.id,B.name);let{data:e,error:t}=await f.ND.from("work_requests").select("*").eq("tenant_id",B.id).order("created_at",{ascending:!1});if(t){console.error("Database query error:",t),console.error("Error details:",JSON.stringify(t,null,2)),console.error("Query was for tenant_id:",B.id),C("Failed to load work requests: ".concat(t.message||t.details||"Unknown error"));return}console.log("Loaded work requests:",e),s(e||[]),o(e||[]);let l={total:(null==e?void 0:e.length)||0,submitted:(null==e?void 0:e.filter(e=>"submitted"===e.status).length)||0,under_review:(null==e?void 0:e.filter(e=>"under_review"===e.status).length)||0,approved:(null==e?void 0:e.filter(e=>"approved"===e.status).length)||0,in_progress:(null==e?void 0:e.filter(e=>"in_progress"===e.status).length)||0,completed:(null==e?void 0:e.filter(e=>"completed"===e.status).length)||0};T(l)}catch(e){console.error("Error loading work requests:",e),C("Failed to load work requests")}finally{_(!1)}};(0,r.useEffect)(()=>{let s=e;D&&(s=s.filter(e=>{var s,t;return e.title.toLowerCase().includes(D.toLowerCase())||e.description.toLowerCase().includes(D.toLowerCase())||(null==(t=e.customer)||null==(s=t.company_name)?void 0:s.toLowerCase().includes(D.toLowerCase()))})),S&&(s=s.filter(e=>e.status===S)),E&&(s=s.filter(e=>e.priority===E)),o(s)},[e,D,S,E]),(0,r.useEffect)(()=>{I()},[null==B?void 0:B.id]);let P=e=>new Date(e).toLocaleDateString(),Z=e=>e.customer_id?"Customer ID: ".concat(e.customer_id):"No Customer";return B?(0,l.jsx)(p.A,{children:(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsx)("div",{className:"bg-green-50 border-l-4 border-green-400 p-4 rounded-md",children:(0,l.jsxs)("div",{className:"flex",children:[(0,l.jsx)("div",{className:"flex-shrink-0",children:(0,l.jsx)(i.A,{className:"h-5 w-5 text-green-400"})}),(0,l.jsx)("div",{className:"ml-3",children:(0,l.jsxs)("p",{className:"text-sm text-green-700",children:[(0,l.jsx)("strong",{children:"âœ… REAL DATABASE DATA"})," - This page now shows actual work requests from your Supabase database, not mock data.",e.length>0&&(0,l.jsxs)("span",{className:"ml-2",children:["Found ",e.length," real work requests in tenant: ",null==B?void 0:B.name]})]})})]})}),(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-2xl font-bold text-green-900",children:"\uD83D\uDD25 REAL Work Requests (Database Connected)"}),(0,l.jsx)("p",{className:"text-green-700",children:"Manage and track your work requests - NOW WITH REAL DATA!"})]}),(0,l.jsxs)(g.$,{onClick:()=>console.log("Create new request"),className:"bg-green-600 hover:bg-green-700",children:[(0,l.jsx)(d.A,{className:"h-4 w-4 mr-2"}),"New Request"]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4",children:[(0,l.jsx)(b.Zp,{className:"border-green-200 bg-green-50",children:(0,l.jsx)(b.Wu,{className:"p-4",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm font-medium text-green-700",children:"Total (REAL)"}),(0,l.jsx)("p",{className:"text-2xl font-bold text-green-900",children:R.total})]}),(0,l.jsx)(n.A,{className:"h-8 w-8 text-green-500"})]})})}),(0,l.jsx)(b.Zp,{className:"border-blue-200 bg-blue-50",children:(0,l.jsx)(b.Wu,{className:"p-4",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm font-medium text-blue-700",children:"Submitted (DB)"}),(0,l.jsx)("p",{className:"text-2xl font-bold text-blue-900",children:R.submitted})]}),(0,l.jsx)(n.A,{className:"h-8 w-8 text-blue-500"})]})})}),(0,l.jsx)(b.Zp,{className:"border-yellow-200 bg-yellow-50",children:(0,l.jsx)(b.Wu,{className:"p-4",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm font-medium text-yellow-700",children:"Under Review (DB)"}),(0,l.jsx)("p",{className:"text-2xl font-bold text-yellow-900",children:R.under_review})]}),(0,l.jsx)(a.A,{className:"h-8 w-8 text-yellow-500"})]})})}),(0,l.jsx)(b.Zp,{className:"border-green-200 bg-green-50",children:(0,l.jsx)(b.Wu,{className:"p-4",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm font-medium text-green-700",children:"Approved (DB)"}),(0,l.jsx)("p",{className:"text-2xl font-bold text-green-900",children:R.approved})]}),(0,l.jsx)(i.A,{className:"h-8 w-8 text-green-500"})]})})}),(0,l.jsx)(b.Zp,{className:"border-indigo-200 bg-indigo-50",children:(0,l.jsx)(b.Wu,{className:"p-4",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm font-medium text-indigo-700",children:"In Progress (DB)"}),(0,l.jsx)("p",{className:"text-2xl font-bold text-indigo-900",children:R.in_progress})]}),(0,l.jsx)(n.A,{className:"h-8 w-8 text-indigo-500"})]})})}),(0,l.jsx)(b.Zp,{className:"border-green-200 bg-green-50",children:(0,l.jsx)(b.Wu,{className:"p-4",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm font-medium text-green-700",children:"Completed (DB)"}),(0,l.jsx)("p",{className:"text-2xl font-bold text-green-900",children:R.completed})]}),(0,l.jsx)(i.A,{className:"h-8 w-8 text-green-500"})]})})})]}),(0,l.jsx)(b.Zp,{children:(0,l.jsx)(b.Wu,{className:"p-4",children:(0,l.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,l.jsx)("div",{className:"flex-1",children:(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)(c.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),(0,l.jsx)(h.p,{placeholder:"Search requests...",value:D,onChange:e=>k(e.target.value),className:"pl-10"})]})}),(0,l.jsxs)("select",{value:S,onChange:e=>q(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,l.jsx)("option",{value:"",children:"All Status"}),(0,l.jsx)("option",{value:"submitted",children:"Submitted"}),(0,l.jsx)("option",{value:"under_review",children:"Under Review"}),(0,l.jsx)("option",{value:"approved",children:"Approved"}),(0,l.jsx)("option",{value:"in_progress",children:"In Progress"}),(0,l.jsx)("option",{value:"completed",children:"Completed"})]}),(0,l.jsxs)("select",{value:E,onChange:e=>L(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,l.jsx)("option",{value:"",children:"All Priority"}),(0,l.jsx)("option",{value:"low",children:"Low"}),(0,l.jsx)("option",{value:"medium",children:"Medium"}),(0,l.jsx)("option",{value:"high",children:"High"}),(0,l.jsx)("option",{value:"critical",children:"Critical"})]})]})})}),(0,l.jsxs)(b.Zp,{className:"border-green-200",children:[(0,l.jsxs)(b.aR,{className:"bg-green-50",children:[(0,l.jsx)(b.ZB,{className:"text-green-900",children:"\uD83D\uDD25 REAL Work Requests from Database"}),(0,l.jsxs)(b.BT,{className:"text-green-700",children:[t.length," of ",e.length," requests from Supabase database",B&&(0,l.jsxs)("span",{className:"ml-2",children:["| Tenant: ",B.name]})]})]}),(0,l.jsx)(b.Wu,{children:y?(0,l.jsxs)("div",{className:"text-center py-12",children:[(0,l.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),(0,l.jsx)("p",{className:"text-gray-600 mt-2",children:"Loading work requests..."})]}):A?(0,l.jsxs)("div",{className:"text-center py-12",children:[(0,l.jsx)("p",{className:"text-red-600 mb-4",children:A}),(0,l.jsx)(g.$,{onClick:I,children:"Try Again"})]}):0===t.length?(0,l.jsxs)("div",{className:"text-center py-12",children:[(0,l.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No work requests found"}),(0,l.jsx)("p",{className:"text-gray-600 mb-4",children:0===e.length?"Get started by creating your first work request.":"Try adjusting your search or filter criteria."}),0===e.length&&(0,l.jsxs)(g.$,{onClick:()=>console.log("Create first request"),children:[(0,l.jsx)(d.A,{className:"h-4 w-4 mr-2"}),"Create First Request"]})]}):(0,l.jsx)("div",{className:"space-y-4",children:t.map(e=>{var s;let t=(null==(s=N[e.status])?void 0:s.icon)||n.A,r=N[e.status]||N.submitted,a=w[e.priority]||w.medium;return(0,l.jsx)("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:(0,l.jsxs)("div",{className:"flex items-start justify-between",children:[(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:e.title}),(0,l.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(r.bg," ").concat(r.color),children:[(0,l.jsx)(t,{className:"w-3 h-3 mr-1"}),r.label]}),(0,l.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(a.bg," ").concat(a.color),children:a.label})]}),(0,l.jsx)("p",{className:"text-gray-600 mb-3",children:e.description}),(0,l.jsxs)("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[(0,l.jsxs)("span",{children:["Customer: ",Z(e)]}),(0,l.jsxs)("span",{children:["Created: ",P(e.created_at)]}),e.category&&(0,l.jsxs)("span",{children:["Category: ",e.category]})]})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2 ml-4",children:[(0,l.jsx)(g.$,{variant:"outline",size:"sm",onClick:()=>console.log("View",e.id),children:(0,l.jsx)(u.A,{className:"h-4 w-4"})}),(0,l.jsx)(g.$,{variant:"outline",size:"sm",onClick:()=>console.log("Edit",e.id),children:(0,l.jsx)(x.A,{className:"h-4 w-4"})}),(0,l.jsx)(g.$,{variant:"outline",size:"sm",onClick:()=>console.log("Delete",e.id),children:(0,l.jsx)(m.A,{className:"h-4 w-4"})})]})]})},e.id)})})})]})]})}):(0,l.jsx)(p.A,{children:(0,l.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,l.jsx)("p",{className:"text-gray-600",children:"Please select a tenant to view work requests."})})})}},7737:(e,s,t)=>{"use strict";t.d(s,{K:()=>d,TenantProvider:()=>o});var l=t(5155),r=t(2115),n=t(2099),a=t(7020);let i=(0,r.createContext)(void 0);function o(e){let{children:s}=e,{user:t,tenantUser:o,isAuthenticated:d,isDemoMode:c}=(0,a.h)(),[u,x]=(0,r.useState)(null),[m,g]=(0,r.useState)([]),[h,b]=(0,r.useState)(!0),p={id:"demo-tenant-id",name:"Demo Company",domain:"demo.company.com",status:"active",subscription_plan:"professional",subscription_start_date:new Date().toISOString(),max_users:100,current_users:5,settings:{},tenant_id:"demo-tenant-id",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},f=async()=>{if(c){g([p]),x(p),b(!1);return}if(!d||!t){g([]),x(null),b(!1);return}try{if((null==o?void 0:o.role)==="host_admin"){let{data:e,error:s}=await n.ND.from("tenants").select("*").order("name");if(s)throw s;g(e||[]);let t=(null==e?void 0:e[0])||null;x(t)}else{let{data:e,error:s}=await n.ND.from("tenant_users").select("tenant_id").eq("user_id",t.id).eq("is_active",!0);if(s)throw s;if(e&&e.length>0){let s=e.map(e=>e.tenant_id),{data:t,error:l}=await n.ND.from("tenants").select("*").in("id",s).order("name");if(l)throw l;g(t||[]);let r=(null==t?void 0:t.find(e=>e.id===(null==o?void 0:o.tenant_id)))||(null==t?void 0:t[0])||null;x(r)}else g([]),x(null)}}catch(e){console.error("Error loading tenants:",e),g([]),x(null)}finally{b(!1)}};return(0,r.useEffect)(()=>{f()},[d,t,o,c]),(0,l.jsx)(i.Provider,{value:{selectedTenant:u,setSelectedTenant:x,availableTenants:m,isLoading:h,loadAvailableTenants:f,canSelectTenant:()=>!c&&((null==o?void 0:o.role)==="host_admin"||(null==o?void 0:o.role)==="program_manager"),isDemoMode:c},children:s})}function d(){let e=(0,r.useContext)(i);if(void 0===e)throw Error("useTenant must be used within a TenantProvider");return e}}},e=>{var s=s=>e(e.s=s);e.O(0,[7590,2354,8937,2099,4660,4619,8441,1684,7358],()=>s(5851)),_N_E=e.O()}]);