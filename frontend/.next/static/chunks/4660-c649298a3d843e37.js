"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4660],{7020:(e,t,a)=>{a.d(t,{AuthProvider:()=>c,h:()=>u});var n=a(5155),r=a(2115),o=a(2099),i=a(8513);class s extends Error{constructor(e,t,a,n){super(e),this.feature=t,this.permission=a,this.userRole=n,this.name="ServiceAuthError"}}let E={host_admin:["*"],program_manager:["".concat(i.Gv.PROJECT_MANAGEMENT,":").concat(i.Jj.MANAGE),"".concat(i.Gv.WORK_REQUESTS,":").concat(i.Jj.MANAGE),"".concat(i.Gv.PROJECT_CHARTER,":").concat(i.Jj.MANAGE),"".concat(i.Gv.RISK_MANAGEMENT,":").concat(i.Jj.MANAGE),"".concat(i.Gv.RESOURCE_MANAGEMENT,":").concat(i.Jj.MANAGE),"".concat(i.Gv.REPORTING,":").concat(i.Jj.VIEW),"".concat(i.Gv.DASHBOARDS,":").concat(i.Jj.VIEW),"".concat(i.Gv.ANALYTICS,":").concat(i.Jj.VIEW),"".concat(i.Gv.USER_MANAGEMENT,":").concat(i.Jj.VIEW),"".concat(i.Gv.MIGRATION_WORKBENCH,":").concat(i.Jj.VIEW),"".concat(i.Gv.DATA_VALIDATION,":").concat(i.Jj.VIEW)],client_admin:["".concat(i.Gv.USER_MANAGEMENT,":").concat(i.Jj.MANAGE),"".concat(i.Gv.ACCESS_CONTROL,":").concat(i.Jj.VIEW),"".concat(i.Gv.PROJECT_MANAGEMENT,":").concat(i.Jj.MANAGE),"".concat(i.Gv.WORK_REQUESTS,":").concat(i.Jj.MANAGE),"".concat(i.Gv.REPORTING,":").concat(i.Jj.VIEW),"".concat(i.Gv.DASHBOARDS,":").concat(i.Jj.VIEW),"".concat(i.Gv.BENEFITS_MANAGEMENT,":").concat(i.Jj.MANAGE),"".concat(i.Gv.EMPLOYEE_RECORDS,":").concat(i.Jj.MANAGE),"".concat(i.Gv.FILE_UPLOAD,":").concat(i.Jj.CREATE),"".concat(i.Gv.DATA_VALIDATION,":").concat(i.Jj.VIEW),"".concat(i.Gv.MIGRATION_WORKBENCH,":").concat(i.Jj.VIEW)],client_user:["".concat(i.Gv.WORK_REQUESTS,":").concat(i.Jj.CREATE),"".concat(i.Gv.WORK_REQUESTS,":").concat(i.Jj.VIEW),"".concat(i.Gv.WORK_REQUESTS,":").concat(i.Jj.UPDATE),"".concat(i.Gv.PROJECT_MANAGEMENT,":").concat(i.Jj.VIEW),"".concat(i.Gv.REPORTING,":").concat(i.Jj.VIEW),"".concat(i.Gv.DASHBOARDS,":").concat(i.Jj.VIEW),"".concat(i.Gv.BENEFITS_MANAGEMENT,":").concat(i.Jj.VIEW),"".concat(i.Gv.FILE_UPLOAD,":").concat(i.Jj.CREATE)]},A=(0,r.createContext)(void 0);function c(e){let{children:t}=e,[a,i]=(0,r.useState)(null),[s,E]=(0,r.useState)(null),[c,u]=(0,r.useState)(!0),[d,N]=(0,r.useState)(!1),[_,S]=(0,r.useState)(null),[l,T]=(0,r.useState)(null),m="https://your-project.supabase.co".includes("placeholder")||"https://your-project.supabase.co".includes("your-project"),R=!!a||!!s||m,G=(null==a?void 0:a.id)||(null==l?void 0:l.user_id)||null,M=(null==_?void 0:_.id)||null,O=(null==l?void 0:l.role)||null,I=()=>{try{localStorage.setItem("etla-auth-context",JSON.stringify({userId:G,tenantId:M,userRole:O,isAuthenticated:R,isDemoMode:m}))}catch(e){console.warn("Failed to store auth context in localStorage:",e)}};(0,r.useEffect)(()=>{console.log("\uD83D\uDD10 AuthProvider: Initializing authentication state"),(async()=>{try{let{data:{session:e},error:t}=await o.ND.auth.getSession();t?(console.error("❌ AuthProvider: Error getting session:",t),i({id:"demo-user-id",email:"demo@company.com",created_at:new Date().toISOString(),updated_at:new Date().toISOString(),app_metadata:{},user_metadata:{},aud:"authenticated",confirmation_sent_at:new Date().toISOString()}),T({id:"demo-tenant-user-id",tenant_id:"54afbd1d-e72a-41e1-9d39-2c8a08a257ff",user_id:"demo-user-id",role:"client_admin",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()})):e?(console.log("✅ AuthProvider: Found existing session"),E(e),i(e.user),T({id:"demo-tenant-user-id",tenant_id:"54afbd1d-e72a-41e1-9d39-2c8a08a257ff",user_id:e.user.id,role:"client_admin",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()})):(console.log("⚠️ AuthProvider: No existing session, using demo user"),i({id:"demo-user-id",email:"demo@company.com",created_at:new Date().toISOString(),updated_at:new Date().toISOString(),app_metadata:{},user_metadata:{},aud:"authenticated",confirmation_sent_at:new Date().toISOString()}),T({id:"demo-tenant-user-id",tenant_id:"demo-tenant-id",user_id:"demo-user-id",role:"host_admin",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()})),u(!1),N(!0),I(),console.log("✅ AuthProvider: Authentication state stabilized")}catch(e){console.error("❌ AuthProvider: Unexpected error during initialization:",e),i(null),E(null),T({id:"demo-tenant-user-id",tenant_id:"54afbd1d-e72a-41e1-9d39-2c8a08a257ff",user_id:"demo-user-id",role:"client_admin",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}),u(!1),N(!0),I()}})();let{data:{subscription:e}}=o.ND.auth.onAuthStateChange(async(e,t)=>{console.log("\uD83D\uDD04 AuthProvider: Auth state changed:",e),t?(E(t),i(t.user),T({id:"demo-tenant-user-id",tenant_id:"54afbd1d-e72a-41e1-9d39-2c8a08a257ff",user_id:t.user.id,role:"client_admin",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()})):(console.log("⚠️ AuthProvider: User signed out, falling back to demo user"),i({id:"demo-user-id",email:"demo@company.com",created_at:new Date().toISOString(),updated_at:new Date().toISOString(),app_metadata:{},user_metadata:{},aud:"authenticated",confirmation_sent_at:new Date().toISOString()}),E(null),T({id:"demo-tenant-user-id",tenant_id:"demo-tenant-id",user_id:"demo-user-id",role:"host_admin",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()})),u(!1),N(!0),I()});return()=>{e.unsubscribe()}},[]);let p=async(e,t)=>{try{let{error:a}=await o.ND.auth.signInWithPassword({email:e,password:t});return{error:a}}catch(e){return console.error("❌ AuthProvider: Sign in error:",e),{error:e}}},g=async(e,t)=>{try{let{error:a}=await o.ND.auth.signUp({email:e,password:t});return{error:a}}catch(e){return console.error("❌ AuthProvider: Sign up error:",e),{error:e}}},f=async()=>{console.log("\uD83D\uDD10 AuthProvider: Signing out");try{await o.ND.auth.signOut(),i(null),E(null),T({id:"demo-tenant-user-id",tenant_id:"demo-tenant-id",user_id:"demo-user-id",role:"host_admin",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}),u(!1),N(!0),I(),window.location.href="/login"}catch(e){console.error("❌ AuthProvider: Error during sign out:",e),window.location.href="/login"}},v=async()=>{console.log("\uD83D\uDD04 AuthProvider: Refreshing tenant information")},h=async()=>{console.log("\uD83D\uDD04 AuthProvider: Refreshing session");try{let{data:{session:e},error:t}=await o.ND.auth.refreshSession();t?console.error("❌ AuthProvider: Error refreshing session:",t):(E(e),(null==e?void 0:e.user)&&i(e.user))}catch(e){console.error("❌ AuthProvider: Unexpected error refreshing session:",e)}};return(0,n.jsx)(A.Provider,{value:{user:a,tenant:_,tenantUser:l,session:s,loading:c,signIn:p,signUp:g,signOut:f,refreshTenant:v,refreshSession:h,isStable:d,isAuthenticated:R,isDemoMode:m,currentUserId:G,currentTenantId:M,currentUserRole:O},children:t})}function u(){let e=(0,r.useContext)(A);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},8513:(e,t,a)=>{a.d(t,{Gv:()=>o,Jj:()=>i,Sk:()=>A}),a(5155);var n=a(7020),r=a(2115);let o={MIGRATION_WORKBENCH:"migration-workbench",FILE_UPLOAD:"file-upload",DATA_VALIDATION:"data-validation",EMPLOYEE_DATA_PROCESSING:"employee-data-processing",PROJECT_MANAGEMENT:"project-management",WORK_REQUESTS:"work-requests",PROJECT_CHARTER:"project-charter",RISK_MANAGEMENT:"risk-management",RESOURCE_MANAGEMENT:"resource-management",REPORTING:"reporting",DASHBOARDS:"dashboards",ANALYTICS:"analytics",HISTORICAL_DATA:"historical-data",USER_MANAGEMENT:"user-management",ACCESS_CONTROL:"access-control",TENANT_MANAGEMENT:"tenant-management",SYSTEM_SETTINGS:"system-settings",AUDIT_LOGS:"audit-logs",BENEFITS_MANAGEMENT:"benefits-management",PAYROLL_PROCESSING:"payroll-processing",EMPLOYEE_RECORDS:"employee-records"},i={VIEW:"view",CREATE:"create",UPDATE:"update",DELETE:"delete",MANAGE:"manage",APPROVE:"approve",EXPORT:"export",IMPORT:"import"},s={TENANT:"tenant"},E={host_admin:{role:"host_admin",permissions:[{feature:o.USER_MANAGEMENT,permission:i.MANAGE},{feature:o.ACCESS_CONTROL,permission:i.MANAGE},{feature:o.TENANT_MANAGEMENT,permission:i.MANAGE},{feature:o.SYSTEM_SETTINGS,permission:i.MANAGE},{feature:o.AUDIT_LOGS,permission:i.VIEW},{feature:o.PROJECT_MANAGEMENT,permission:i.MANAGE},{feature:o.WORK_REQUESTS,permission:i.MANAGE},{feature:o.REPORTING,permission:i.MANAGE},{feature:o.MIGRATION_WORKBENCH,permission:i.MANAGE},{feature:o.BENEFITS_MANAGEMENT,permission:i.MANAGE}]},program_manager:{role:"program_manager",permissions:[{feature:o.PROJECT_MANAGEMENT,permission:i.MANAGE},{feature:o.WORK_REQUESTS,permission:i.MANAGE},{feature:o.PROJECT_CHARTER,permission:i.MANAGE},{feature:o.RISK_MANAGEMENT,permission:i.MANAGE},{feature:o.RESOURCE_MANAGEMENT,permission:i.MANAGE},{feature:o.REPORTING,permission:i.VIEW},{feature:o.DASHBOARDS,permission:i.VIEW},{feature:o.ANALYTICS,permission:i.VIEW},{feature:o.USER_MANAGEMENT,permission:i.VIEW},{feature:o.MIGRATION_WORKBENCH,permission:i.VIEW},{feature:o.DATA_VALIDATION,permission:i.VIEW}]},client_admin:{role:"client_admin",permissions:[{feature:o.USER_MANAGEMENT,permission:i.MANAGE},{feature:o.ACCESS_CONTROL,permission:i.VIEW},{feature:o.PROJECT_MANAGEMENT,permission:i.MANAGE},{feature:o.WORK_REQUESTS,permission:i.MANAGE},{feature:o.REPORTING,permission:i.VIEW},{feature:o.DASHBOARDS,permission:i.VIEW},{feature:o.BENEFITS_MANAGEMENT,permission:i.MANAGE},{feature:o.EMPLOYEE_RECORDS,permission:i.MANAGE},{feature:o.FILE_UPLOAD,permission:i.CREATE},{feature:o.DATA_VALIDATION,permission:i.VIEW},{feature:o.MIGRATION_WORKBENCH,permission:i.VIEW}]},client_user:{role:"client_user",permissions:[{feature:o.WORK_REQUESTS,permission:i.CREATE},{feature:o.WORK_REQUESTS,permission:i.VIEW},{feature:o.WORK_REQUESTS,permission:i.UPDATE},{feature:o.PROJECT_MANAGEMENT,permission:i.VIEW},{feature:o.REPORTING,permission:i.VIEW},{feature:o.DASHBOARDS,permission:i.VIEW},{feature:o.BENEFITS_MANAGEMENT,permission:i.VIEW},{feature:o.FILE_UPLOAD,permission:i.CREATE}]}};function A(){let{user:e,tenantUser:t,isAuthenticated:a,isDemoMode:A}=(0,n.h)(),[c,u]=(0,r.useState)([]),[d,N]=(0,r.useState)(!0);(0,r.useEffect)(()=>{if(!a||!t){u([]),N(!1);return}let e=E[t.role];e?u(e.permissions):u(E.client_user.permissions),N(!1)},[a,t]);let _=function(e,n){return arguments.length>2&&void 0!==arguments[2]?arguments[2]:s.TENANT,!!A||!!a&&!!t&&("host_admin"===t.role||c.some(t=>t.feature===e&&t.permission===n))},S=e=>!!A||!!a&&!!t&&("host_admin"===t.role||c.some(t=>t.feature===e)),l=e=>_(e,i.CREATE)||_(e,i.MANAGE),T=e=>_(e,i.UPDATE)||_(e,i.MANAGE),m=e=>_(e,i.DELETE)||_(e,i.MANAGE),R=e=>_(e,i.VIEW)||_(e,i.MANAGE)||l(e)||T(e),G=e=>_(e,i.MANAGE),M=e=>_(e,i.APPROVE)||_(e,i.MANAGE),O=e=>_(e,i.EXPORT)||_(e,i.MANAGE),I=()=>!!a&&!!t&&["host_admin","client_admin"].includes(t.role),p=()=>!!a&&!!t&&"host_admin"===t.role,g=()=>_(o.USER_MANAGEMENT,i.MANAGE),f=()=>S(o.ACCESS_CONTROL)||S(o.USER_MANAGEMENT)||S(o.SYSTEM_SETTINGS);return{hasPermission:_,canAccessFeature:S,getPermissionLevel:e=>A?[i.MANAGE]:a&&t?"host_admin"===t.role?[i.MANAGE]:c.filter(t=>t.feature===e).map(e=>e.permission):[],canCreate:l,canUpdate:T,canDelete:m,canView:R,canManage:G,canApprove:M,canExport:O,canImport:e=>_(e,i.IMPORT)||_(e,i.MANAGE),getAccessibleFeatures:()=>A?Object.values(o):a&&t?"host_admin"===t.role?Object.values(o):Array.from(new Set(c.map(e=>e.feature))):[],getUserPermissions:()=>({workRequests:{view:R(o.WORK_REQUESTS),create:l(o.WORK_REQUESTS),update:T(o.WORK_REQUESTS),approve:M(o.WORK_REQUESTS)},projects:{view:R(o.PROJECT_MANAGEMENT),create:l(o.PROJECT_MANAGEMENT),update:T(o.PROJECT_MANAGEMENT),delete:m(o.PROJECT_MANAGEMENT)},risks:{view:R(o.RISK_MANAGEMENT),manage:G(o.RISK_MANAGEMENT)},users:{view:R(o.USER_MANAGEMENT),manage:g()},reports:{view:R(o.REPORTING),export:O(o.REPORTING)},admin:{access:f(),isAdmin:I(),isHostAdmin:p()}}),isAdmin:I,isHostAdmin:p,canManageUsers:g,canAccessAdmin:f,userPermissions:c,isLoading:d,isDemoMode:A,isAuthenticated:a,currentRole:null==t?void 0:t.role,currentUserId:null==e?void 0:e.id,currentTenantId:null==t?void 0:t.tenant_id}}}}]);