"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4660],{7020:(e,t,a)=>{a.d(t,{AuthProvider:()=>u,h:()=>d});var n=a(5155),r=a(2115),o=a(2099),i=a(8513);class E extends Error{constructor(e,t,a,n){super(e),this.feature=t,this.permission=a,this.userRole=n,this.name="ServiceAuthError"}}let s={host_admin:["*"],program_manager:["".concat(i.Gv.PROJECT_MANAGEMENT,":").concat(i.Jj.MANAGE),"".concat(i.Gv.WORK_REQUESTS,":").concat(i.Jj.MANAGE),"".concat(i.Gv.PROJECT_CHARTER,":").concat(i.Jj.MANAGE),"".concat(i.Gv.RISK_MANAGEMENT,":").concat(i.Jj.MANAGE),"".concat(i.Gv.RESOURCE_MANAGEMENT,":").concat(i.Jj.MANAGE),"".concat(i.Gv.REPORTING,":").concat(i.Jj.VIEW),"".concat(i.Gv.DASHBOARDS,":").concat(i.Jj.VIEW),"".concat(i.Gv.ANALYTICS,":").concat(i.Jj.VIEW),"".concat(i.Gv.USER_MANAGEMENT,":").concat(i.Jj.VIEW),"".concat(i.Gv.MIGRATION_WORKBENCH,":").concat(i.Jj.VIEW),"".concat(i.Gv.DATA_VALIDATION,":").concat(i.Jj.VIEW)],client_admin:["".concat(i.Gv.USER_MANAGEMENT,":").concat(i.Jj.MANAGE),"".concat(i.Gv.ACCESS_CONTROL,":").concat(i.Jj.VIEW),"".concat(i.Gv.PROJECT_MANAGEMENT,":").concat(i.Jj.MANAGE),"".concat(i.Gv.WORK_REQUESTS,":").concat(i.Jj.MANAGE),"".concat(i.Gv.REPORTING,":").concat(i.Jj.VIEW),"".concat(i.Gv.DASHBOARDS,":").concat(i.Jj.VIEW),"".concat(i.Gv.BENEFITS_MANAGEMENT,":").concat(i.Jj.MANAGE),"".concat(i.Gv.EMPLOYEE_RECORDS,":").concat(i.Jj.MANAGE),"".concat(i.Gv.FILE_UPLOAD,":").concat(i.Jj.CREATE),"".concat(i.Gv.DATA_VALIDATION,":").concat(i.Jj.VIEW),"".concat(i.Gv.MIGRATION_WORKBENCH,":").concat(i.Jj.VIEW)],client_user:["".concat(i.Gv.WORK_REQUESTS,":").concat(i.Jj.CREATE),"".concat(i.Gv.WORK_REQUESTS,":").concat(i.Jj.VIEW),"".concat(i.Gv.WORK_REQUESTS,":").concat(i.Jj.UPDATE),"".concat(i.Gv.PROJECT_MANAGEMENT,":").concat(i.Jj.VIEW),"".concat(i.Gv.REPORTING,":").concat(i.Jj.VIEW),"".concat(i.Gv.DASHBOARDS,":").concat(i.Jj.VIEW),"".concat(i.Gv.BENEFITS_MANAGEMENT,":").concat(i.Jj.VIEW),"".concat(i.Gv.FILE_UPLOAD,":").concat(i.Jj.CREATE)]};var A=a(9509);let c=(0,r.createContext)(void 0);function u(e){let{children:t}=e,[a,i]=(0,r.useState)(null),[E,s]=(0,r.useState)(null),[u,d]=(0,r.useState)(!0),[_,N]=(0,r.useState)(!1),[S,T]=(0,r.useState)(null),[R,l]=(0,r.useState)(null),m=!A.env.NEXT_PUBLIC_SUPABASE_URL||"https://demo.supabase.co"===A.env.NEXT_PUBLIC_SUPABASE_URL||A.env.NEXT_PUBLIC_SUPABASE_URL.includes("placeholder")||A.env.NEXT_PUBLIC_SUPABASE_URL.includes("your-project")||"https://your-project.supabase.co"===A.env.NEXT_PUBLIC_SUPABASE_URL,I=!!a||!!E||m,O=(null==a?void 0:a.id)||(null==R?void 0:R.user_id)||null,M=(null==S?void 0:S.id)||null,G=(null==R?void 0:R.role)||null,p=()=>{try{localStorage.setItem("etla-auth-context",JSON.stringify({userId:O,tenantId:M,userRole:G,isAuthenticated:I,isDemoMode:m}))}catch(e){console.warn("Failed to store auth context in localStorage:",e)}};(0,r.useEffect)(()=>{console.log("\uD83D\uDD10 AuthProvider: Initializing authentication state"),(async()=>{try{let{data:{session:e},error:t}=await o.ND.auth.getSession();t?(console.error("❌ AuthProvider: Error getting session:",t),i({id:"b224935f-732f-4b09-a4a0-16492c5ae563",email:"demo.hostmanager@democompany.com",created_at:new Date().toISOString(),updated_at:new Date().toISOString(),app_metadata:{},user_metadata:{},aud:"authenticated",confirmation_sent_at:new Date().toISOString()}),l({id:"demo-tenant-user-id",tenant_id:"54afbd1d-e72a-41e1-9d39-2c8a08a257ff",user_id:"b224935f-732f-4b09-a4a0-16492c5ae563",role:"client_admin",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()})):e?(console.log("✅ AuthProvider: Found existing session"),s(e),i(e.user),l({id:"demo-tenant-user-id",tenant_id:"54afbd1d-e72a-41e1-9d39-2c8a08a257ff",user_id:e.user.id,role:"client_admin",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()})):(console.log("⚠️ AuthProvider: No existing session, using demo user"),i({id:"b224935f-732f-4b09-a4a0-16492c5ae563",email:"demo.hostmanager@democompany.com",created_at:new Date().toISOString(),updated_at:new Date().toISOString(),app_metadata:{},user_metadata:{},aud:"authenticated",confirmation_sent_at:new Date().toISOString()}),l({id:"demo-tenant-user-id",tenant_id:"demo-tenant-id",user_id:"b224935f-732f-4b09-a4a0-16492c5ae563",role:"host_admin",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()})),d(!1),N(!0),p(),console.log("✅ AuthProvider: Authentication state stabilized")}catch(e){console.error("❌ AuthProvider: Unexpected error during initialization:",e),i(null),s(null),l({id:"demo-tenant-user-id",tenant_id:"54afbd1d-e72a-41e1-9d39-2c8a08a257ff",user_id:"b224935f-732f-4b09-a4a0-16492c5ae563",role:"client_admin",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}),d(!1),N(!0),p()}})();let{data:{subscription:e}}=o.ND.auth.onAuthStateChange(async(e,t)=>{console.log("\uD83D\uDD04 AuthProvider: Auth state changed:",e),t?(s(t),i(t.user),l({id:"demo-tenant-user-id",tenant_id:"54afbd1d-e72a-41e1-9d39-2c8a08a257ff",user_id:t.user.id,role:"client_admin",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()})):(console.log("⚠️ AuthProvider: User signed out, falling back to demo user"),i({id:"b224935f-732f-4b09-a4a0-16492c5ae563",email:"demo@company.com",created_at:new Date().toISOString(),updated_at:new Date().toISOString(),app_metadata:{},user_metadata:{},aud:"authenticated",confirmation_sent_at:new Date().toISOString()}),s(null),l({id:"demo-tenant-user-id",tenant_id:"demo-tenant-id",user_id:"b224935f-732f-4b09-a4a0-16492c5ae563",role:"host_admin",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()})),d(!1),N(!0),p()});return()=>{e.unsubscribe()}},[]);let f=async(e,t)=>{try{let{error:a}=await o.ND.auth.signInWithPassword({email:e,password:t});return{error:a}}catch(e){return console.error("❌ AuthProvider: Sign in error:",e),{error:e}}},v=async(e,t)=>{try{let{error:a}=await o.ND.auth.signUp({email:e,password:t});return{error:a}}catch(e){return console.error("❌ AuthProvider: Sign up error:",e),{error:e}}},g=async()=>{console.log("\uD83D\uDD10 AuthProvider: Signing out");try{await o.ND.auth.signOut(),i(null),s(null),l({id:"demo-tenant-user-id",tenant_id:"demo-tenant-id",user_id:"b224935f-732f-4b09-a4a0-16492c5ae563",role:"host_admin",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}),d(!1),N(!0),p(),window.location.href="/login"}catch(e){console.error("❌ AuthProvider: Error during sign out:",e),window.location.href="/login"}},h=async()=>{console.log("\uD83D\uDD04 AuthProvider: Refreshing tenant information")},P=async()=>{console.log("\uD83D\uDD04 AuthProvider: Refreshing session");try{let{data:{session:e},error:t}=await o.ND.auth.refreshSession();t?console.error("❌ AuthProvider: Error refreshing session:",t):(s(e),(null==e?void 0:e.user)&&i(e.user))}catch(e){console.error("❌ AuthProvider: Unexpected error refreshing session:",e)}};return(0,n.jsx)(c.Provider,{value:{user:a,tenant:S,tenantUser:R,session:E,loading:u,signIn:f,signUp:v,signOut:g,refreshTenant:h,refreshSession:P,isStable:_,isAuthenticated:I,isDemoMode:m,currentUserId:O,currentTenantId:M,currentUserRole:G},children:t})}function d(){let e=(0,r.useContext)(c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},8513:(e,t,a)=>{a.d(t,{Gv:()=>o,Jj:()=>i,Sk:()=>A}),a(5155);var n=a(7020),r=a(2115);let o={MIGRATION_WORKBENCH:"migration-workbench",FILE_UPLOAD:"file-upload",DATA_VALIDATION:"data-validation",EMPLOYEE_DATA_PROCESSING:"employee-data-processing",PROJECT_MANAGEMENT:"project-management",WORK_REQUESTS:"work-requests",PROJECT_CHARTER:"project-charter",RISK_MANAGEMENT:"risk-management",RESOURCE_MANAGEMENT:"resource-management",REPORTING:"reporting",DASHBOARDS:"dashboards",ANALYTICS:"analytics",HISTORICAL_DATA:"historical-data",USER_MANAGEMENT:"user-management",ACCESS_CONTROL:"access-control",TENANT_MANAGEMENT:"tenant-management",SYSTEM_SETTINGS:"system-settings",AUDIT_LOGS:"audit-logs",BENEFITS_MANAGEMENT:"benefits-management",PAYROLL_PROCESSING:"payroll-processing",EMPLOYEE_RECORDS:"employee-records"},i={VIEW:"view",CREATE:"create",UPDATE:"update",DELETE:"delete",MANAGE:"manage",APPROVE:"approve",EXPORT:"export",IMPORT:"import"},E={TENANT:"tenant"},s={host_admin:{role:"host_admin",permissions:[{feature:o.USER_MANAGEMENT,permission:i.MANAGE},{feature:o.ACCESS_CONTROL,permission:i.MANAGE},{feature:o.TENANT_MANAGEMENT,permission:i.MANAGE},{feature:o.SYSTEM_SETTINGS,permission:i.MANAGE},{feature:o.AUDIT_LOGS,permission:i.VIEW},{feature:o.PROJECT_MANAGEMENT,permission:i.MANAGE},{feature:o.WORK_REQUESTS,permission:i.MANAGE},{feature:o.REPORTING,permission:i.MANAGE},{feature:o.MIGRATION_WORKBENCH,permission:i.MANAGE},{feature:o.BENEFITS_MANAGEMENT,permission:i.MANAGE}]},program_manager:{role:"program_manager",permissions:[{feature:o.PROJECT_MANAGEMENT,permission:i.MANAGE},{feature:o.WORK_REQUESTS,permission:i.MANAGE},{feature:o.PROJECT_CHARTER,permission:i.MANAGE},{feature:o.RISK_MANAGEMENT,permission:i.MANAGE},{feature:o.RESOURCE_MANAGEMENT,permission:i.MANAGE},{feature:o.REPORTING,permission:i.VIEW},{feature:o.DASHBOARDS,permission:i.VIEW},{feature:o.ANALYTICS,permission:i.VIEW},{feature:o.USER_MANAGEMENT,permission:i.VIEW},{feature:o.MIGRATION_WORKBENCH,permission:i.VIEW},{feature:o.DATA_VALIDATION,permission:i.VIEW}]},client_admin:{role:"client_admin",permissions:[{feature:o.USER_MANAGEMENT,permission:i.MANAGE},{feature:o.ACCESS_CONTROL,permission:i.VIEW},{feature:o.PROJECT_MANAGEMENT,permission:i.MANAGE},{feature:o.WORK_REQUESTS,permission:i.MANAGE},{feature:o.REPORTING,permission:i.VIEW},{feature:o.DASHBOARDS,permission:i.VIEW},{feature:o.BENEFITS_MANAGEMENT,permission:i.MANAGE},{feature:o.EMPLOYEE_RECORDS,permission:i.MANAGE},{feature:o.FILE_UPLOAD,permission:i.CREATE},{feature:o.DATA_VALIDATION,permission:i.VIEW},{feature:o.MIGRATION_WORKBENCH,permission:i.VIEW}]},client_user:{role:"client_user",permissions:[{feature:o.WORK_REQUESTS,permission:i.CREATE},{feature:o.WORK_REQUESTS,permission:i.VIEW},{feature:o.WORK_REQUESTS,permission:i.UPDATE},{feature:o.PROJECT_MANAGEMENT,permission:i.VIEW},{feature:o.REPORTING,permission:i.VIEW},{feature:o.DASHBOARDS,permission:i.VIEW},{feature:o.BENEFITS_MANAGEMENT,permission:i.VIEW},{feature:o.FILE_UPLOAD,permission:i.CREATE},{feature:o.ACCESS_CONTROL,permission:i.VIEW},{feature:o.USER_MANAGEMENT,permission:i.VIEW}]},user:{role:"user",permissions:[{feature:o.WORK_REQUESTS,permission:i.CREATE},{feature:o.WORK_REQUESTS,permission:i.VIEW},{feature:o.WORK_REQUESTS,permission:i.UPDATE},{feature:o.PROJECT_MANAGEMENT,permission:i.VIEW},{feature:o.REPORTING,permission:i.VIEW},{feature:o.DASHBOARDS,permission:i.VIEW},{feature:o.BENEFITS_MANAGEMENT,permission:i.VIEW},{feature:o.FILE_UPLOAD,permission:i.CREATE},{feature:o.ACCESS_CONTROL,permission:i.VIEW},{feature:o.USER_MANAGEMENT,permission:i.VIEW}]}};function A(){let{user:e,tenantUser:t,isAuthenticated:a,isDemoMode:A}=(0,n.h)(),[c,u]=(0,r.useState)([]),[d,_]=(0,r.useState)(!0);(0,r.useEffect)(()=>{if(!a||!t){u([]),_(!1);return}let e=s[t.role];e?u(e.permissions):u(s.client_user.permissions),_(!1)},[a,t]);let N=function(e,n){return arguments.length>2&&void 0!==arguments[2]?arguments[2]:E.TENANT,!!A||!!a&&!!t&&("host_admin"===t.role||c.some(t=>t.feature===e&&t.permission===n))},S=e=>!!A||!!a&&!!t&&("host_admin"===t.role||c.some(t=>t.feature===e)),T=e=>N(e,i.CREATE)||N(e,i.MANAGE),R=e=>N(e,i.UPDATE)||N(e,i.MANAGE),l=e=>N(e,i.DELETE)||N(e,i.MANAGE),m=e=>N(e,i.VIEW)||N(e,i.MANAGE)||T(e)||R(e),I=e=>N(e,i.MANAGE),O=e=>N(e,i.APPROVE)||N(e,i.MANAGE),M=e=>N(e,i.EXPORT)||N(e,i.MANAGE),G=()=>!!a&&!!t&&["host_admin","client_admin"].includes(t.role),p=()=>!!a&&!!t&&"host_admin"===t.role,f=()=>N(o.USER_MANAGEMENT,i.MANAGE),v=()=>S(o.ACCESS_CONTROL)||S(o.USER_MANAGEMENT)||S(o.SYSTEM_SETTINGS);return{hasPermission:N,canAccessFeature:S,getPermissionLevel:e=>A?[i.MANAGE]:a&&t?"host_admin"===t.role?[i.MANAGE]:c.filter(t=>t.feature===e).map(e=>e.permission):[],canCreate:T,canUpdate:R,canDelete:l,canView:m,canManage:I,canApprove:O,canExport:M,canImport:e=>N(e,i.IMPORT)||N(e,i.MANAGE),getAccessibleFeatures:()=>A?Object.values(o):a&&t?"host_admin"===t.role?Object.values(o):Array.from(new Set(c.map(e=>e.feature))):[],getUserPermissions:()=>({workRequests:{view:m(o.WORK_REQUESTS),create:T(o.WORK_REQUESTS),update:R(o.WORK_REQUESTS),approve:O(o.WORK_REQUESTS)},projects:{view:m(o.PROJECT_MANAGEMENT),create:T(o.PROJECT_MANAGEMENT),update:R(o.PROJECT_MANAGEMENT),delete:l(o.PROJECT_MANAGEMENT)},risks:{view:m(o.RISK_MANAGEMENT),manage:I(o.RISK_MANAGEMENT)},users:{view:m(o.USER_MANAGEMENT),manage:f()},reports:{view:m(o.REPORTING),export:M(o.REPORTING)},admin:{access:v(),isAdmin:G(),isHostAdmin:p()}}),isAdmin:G,isHostAdmin:p,canManageUsers:f,canAccessAdmin:v,userPermissions:c,isLoading:d,isDemoMode:A,isAuthenticated:a,currentRole:null==t?void 0:t.role,currentUserId:null==e?void 0:e.id,currentTenantId:null==t?void 0:t.tenant_id}}}}]);